(function(a,f){"function"===typeof define&&define.amd?define("jquery mooAjax mooButton mooAlert mooPhrase spinner tokeninput".split(" "),f):"object"===typeof exports?module.exports=f(require("jquery")):a.mooGlobal=f()})(this,function(a,f,g,k,d){var l=function(){a.get(mooConfig.url.base+"/conversations/ajax_browse?keyword="+a("#conv_keyword").val(),function(b){a("#list-content").html(b)})};return{initInviteFriendBtn:function(b){a("#inviteButton").unbind("click");a("#inviteButton").click(function(){a("#inviteButton").spin("small");
g.disableButton("inviteButton");a(".error-message").hide();f.post({url:mooConfig.url.base+"/friends/ajax_invite?mode="+b,data:a("#inviteForm").serialize()},function(c){g.enableButton("inviteButton");a("#inviteButton").spin(!1);c=a.parseJSON(c);1==c.result?"model"==b?(a("#inviteFormBody").html(d.__("your_invitation_has_been_sent")),a("#inviteButton").remove()):(a("#to").val(""),a("#message").val(""),a(".error-message").hide(),k.alert(d.__("your_invitation_has_been_sent")),"object"==typeof grecaptcha&&
grecaptcha.reset()):(a(".error-message").show(),a(".error-message").html(c.message))});return!1})},initConversationSendBtn:function(){a("#friends").tokenInput(mooConfig.url.base+"/friends/do_get_json",{preventDuplicates:!0,hintText:d.__("enter_a_friend_s_name"),noResultsText:d.__("no_results"),tokenLimit:20,resultsFormatter:function(b){return'<li class="token-input-result-item"><div class="token-input-result-main"><div class="token-input-result-img">'+b.avatar+'</div><div class="token-input-result-name">'+
b.name+"</div></div></li>"}});a("#sendButton").unbind("click");a("#sendButton").click(function(){g.disableButton("sendButton");a("#sendButton").spin("small");a.post(mooConfig.url.base+"/conversations/ajax_doSend",a("#sendMessage").serialize(),function(b){g.enableButton("sendButton");a("#sendButton").spin(!1);b=a.parseJSON(b);1==b.result?(a("#subject").val(""),a("#message").val(""),a(".error-message").hide(),a("#themeModal").modal("hide"),k.alert(d.__("your_message_has_been_sent"))):(a(".error-message").show(),
a(".error-message").html(b.message))});return!1})},initLeaveConversation:function(){a(".leaveConversation").unbind("click");a(".leaveConversation").on("click",function(){var b=a(this).data();k.confirm(b.msg,b.url)})},errorHandler:function(b,c,e){0==mooConfig.product_mode&&(e=d.__("upload_error"));0<a(this._element).find(".qq-upload-list .errorUploadMsg").length?a(this._element).find(".qq-upload-list .errorUploadMsg").html(e):a(this._element).find(".qq-upload-list").prepend('<li class="errorUploadMsg">'+
e+"</li>");a(this._element).find(".qq-upload-fail").remove()},initConversationAjaxAdd:function(){a("#friends").tokenInput(mooConfig.url.base+"/friends/do_get_json",{preventDuplicates:!0,hintText:d.__("enter_a_friend_s_name"),noResultsText:d.__("no_results"),tokenLimit:20,resultsFormatter:function(b){return'<li class="token-input-result-item"><div class="token-input-result-main"><div class="token-input-result-img">'+b.avatar+'</div><div class="token-input-result-name">'+b.name+"</div></div></li>"}});
a("#sendButton").click(function(){g.disableButton("sendButton");a.post(mooConfig.url.base+"/conversations/ajax_doAdd",a("#sendMessage").serialize(),function(b){g.enableButton("sendButton");b=a.parseJSON(b);1==b.result?window.location.reload():(a(".error-message").show(),a(".error-message").html(b.message))});return!1})},initMsgList:function(){a(".markMsgStaus").unbind("click");a(".markMsgStaus").click(function(){var b=a(this).data(),c=a(this);f.post({url:mooConfig.url.base+"/conversations/mark_read",
data:{id:b.id,status:b.status}},function(e){e=a.parseJSON(e);var h=a("#messages .badge_counter").html();"1"===e.status?(c.parents("li:first").find(".notification-group-main").addClass("unread"),c.hide(),c.prev().show(),a("#messages .badge_counter").html(parseInt(h)+1),0<a(".conversation_count").length?a(".conversation_count").html(parseInt(h)+1):a("#conversationDropdown").append('<span class="conversation_count">1</span>')):(c.parents("li:first").find(".notification-group-main").removeClass("unread"),
c.hide(),c.next().show(),a("#messages .badge_counter").html(parseInt(h)-1),0<parseInt(h)-1?0<a(".conversation_count").length?a(".conversation_count").html(parseInt(h)-1):a("#conversationDropdown").append('<span class="conversation_count">1</span>'):a(".conversation_count")&&a(".conversation_count").remove())})})},initSearchMessage:function(){a("#form_friend_search").submit(function(b){b.preventDefault();return!1});a("#form_friend_search").find(".header_search_btn").click(function(b){l()});a("#form_conv_search").submit(function(b){b.preventDefault();
return!1});a("#form_conv_search").find(".header_search_btn").click(function(b){l()});a("#conv_keyword").on("keyup",function(b){l()})}}});