(function(a,d){"function"===typeof define&&define.amd?define("jquery mooPhrase mooFileUploader mooAlert mooGlobal mooButton mooOverlay mooBehavior mooAjax mooTooltip Cropper mooCoreMenu spinner tipsy multiselect Jcrop bootstrap".split(" "),d):"object"===typeof exports?module.exports=d(require("jquery")):a.mooUser=d()})(this,function(a,d,x,u,y,k,E,F,J,K,z,T){var v=function(){if("undefined"==typeof mooViewer)return a.fn.SimpleModal({btn_ok:d.__("btn_ok"),btn_cancel:d.__("btn_cancel"),model:"modal",
title:d.__("warning"),contents:d.__("please_login")}).showModal(),!1;if(mooCore["setting.require_email_validation"]&&!mooViewer.is_confirmed)return a.fn.SimpleModal({btn_ok:d.__("btn_ok"),btn_cancel:d.__("btn_cancel"),model:"modal",title:d.__("confirm_email_warning"),contents:d.__("please_confirm_your_email")}).showModal(),!1;if(mooCore["setting.approve_users"]&&!mooViewer.is_approved)return a.fn.SimpleModal({btn_ok:d.__("btn_ok"),btn_cancel:d.__("btn_cancel"),model:"modal",title:d.__("warning"),
contents:d.__("your_account_is_pending_approval")}).showModal(),!1;var b={status:!0,message:""};a("body").trigger("validateUser",[b]);return b.status?!0:(a.fn.SimpleModal({btn_ok:d.__("btn_ok"),btn_cancel:d.__("btn_cancel"),model:"modal",title:d.__("warning"),contents:b.message}).showModal(),!1)},w=function(b){m=b.x;n=b.y;p=b.w;q=b.h},A,h,m=0,n=0,p=0,q=0,C=function(b){a(".rotate_avatar").unbind("click");a(".rotate_avatar").on("click",function(){a(".rotate_avatar").hide();var c=a(this).data();a("#avatar_wrapper").spin("large");
a.post(mooConfig.url.base+"/users/ajax_rotate",{mode:c.mode},function(e){dataJson=JSON.parse(e);a("#avatar_wrapper").spin(!1);a(".rotate_avatar").show();a("#av-img").attr("src",dataJson["200_square"]);a("#av-img2").attr("src",dataJson["600"]);mooConfig.isMobile?h.replace(dataJson["600"]):b.setImage(dataJson["600"]);a("#member-avatar").attr("src",dataJson["50_square"])})})};q=p=n=m=0;var L=function(b,c){if(!v())return!1;a.post(mooConfig.url.base+"/friends/ajax_respond",{id:b,status:c},function(e){location.reload()})},
M=function(){k.disableButton("checkButton");a.post(mooConfig.url.base+"/users/ajax_username",{username:a("#username").val()},function(b){k.enableButton("checkButton");b=a.parseJSON(b);a("#message").html(b.message);1==b.result?a("#message").css("color","green"):a("#message").css("color","red");a("#message").show()})},O=function(){a(".removeMember").unbind("click");a(".removeMember").on("click",function(){var b=a(this).data();N(b.id)})},Q=function(){a(".changeAdmin").unbind("click");a(".changeAdmin").on("click",
function(){var b=a(this).data();P(b.id,b.type)})},N=function(b){a.fn.SimpleModal({btn_ok:d.__("btn_ok"),btn_cancel:d.__("btn_cancel"),callback:function(){a.post(mooConfig.url.base+"/groups/ajax_remove_member",{id:b},function(){a("#member_"+b).fadeOut();"0"!=a("#group_user_count").html()&&a("#group_user_count").html(parseInt(a("#group_user_count").html())-1)})},title:d.__("please_confirm"),contents:d.__("are_you_sure_you_want_to_remove_this_member"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal();
return!1},P=function(b,c){var e=d.__("are_you_sure_you_want_to_make_this_member_a_group_admin");"remove"==c&&(e=d.__("are_you_sure_you_want_to_demote_this_group_admin"));a.fn.SimpleModal({btn_ok:d.__("btn_ok"),btn_cancel:d.__("btn_cancel"),callback:function(){a.post(mooConfig.url.base+"/groups/ajax_change_admin",{id:b,type:c},function(){window.location.reload()})},title:d.__("please_confirm"),contents:e,model:"confirm",hideFooter:!1,closeButton:!1}).showModal();return!1},G=function(){a(".respondRequest").unbind("click");
a(".respondRequest").on("click",function(){a(".respondRequest").unbind("click");var b=a(this).data();L(b.id,b.status)});a(".user_action_follow").unbind("click");a(".user_action_follow").click(function(){if(!v())return!1;element=a(this);a.ajax({type:"POST",url:mooConfig.url.base+"/follows/ajax_update_follow",data:{user_id:a(this).data("uid")},success:function(b){a(".core_user_follow[data-uid="+element.data("uid")+"]").each(function(){a(this).data("follow")?(a(this).data("follow",0),a(this).attr("data-follow",
0),a(this).find(".btn-text").html(d.__("text_follow")),a(this).find(".btn-icon").html("rss_feed"),a(this).find(".btn-icon").removeClass("moo-icon-check"),a(this).find(".btn-icon").addClass("moo-icon-rss_feed")):(a(this).data("follow",1),a(this).attr("data-follow",1),a(this).find(".btn-text").html(d.__("text_unfollow")),a(this).find(".btn-icon").html("check"),a(this).find(".btn-icon").removeClass("moo-icon-rss_feed"),a(this).find(".btn-icon").addClass("moo-icon-check"))})}})});0==a(".profile-action .dropdown-menu li").length&&
a(".profile-action .dropdown").hide()},R=function(b){a("#user_photos").spin("tiny");a("#user_photos").children(".badge_counter").hide();a("#profile-content").load(mooConfig.url.base+"/photos/profile_user_album/"+b,{noCache:1},function(c){a(this).html(c);a("#user_photos").spin(!1);a("#user_photos").children(".badge_counter").fadeIn()})},S=function(){var b=0;return function(c,e){clearTimeout(b);b=setTimeout(c,e)}}(),H=function(b){S(function(){url=b?mooConfig.url.base+"/users/profile_user_friends/"+
b:mooConfig.url.base+"/users/ajax_browse/home";a.post(url,{is_search:!0,search:a("#search_friend").val()},function(c){a("#list-content").html(c);F.initMoreResults();K.init()})},200)};return{validateUser:v,initOnRegistration:function(){a("#username").keyup(function(){var b="";""!=a("#username").val().trim()&&(b="-"+a("#username").val().trim());a("#profile_user_name").html(b)});a("#submitFormsignup").unbind("click");a("#submitFormsignup").click(function(){a("#step1Box").spin("small");a("#submitFormsignup").attr("disabled",
"disabled");a.post(mooConfig.url.base+"/users/ajax_signup_step1",a("#regForm").serialize(),function(b){a("#step1Box").spin(!1);if(0<b.indexOf("mooError"))a("#regError").fadeIn(),a("#regError").html(b),a("#submitFormsignup").removeAttr("disabled");else{a("#regError").fadeOut();var c={status:!1,data:b};a("body").trigger("initOnRegistrationStep1Callback",[c]);c.status||a("#regFields").append(b);a("#captcha").fadeIn();a("#step1Box").remove();a(".tip").tipsy({html:!0,gravity:"s"});a(".multi").multiSelect({selectAll:!1,
noneSelected:"",oneOrMoreSelected:d.__("per_selected")})}})});a("#step2Submit").unbind("click");a("#step2Submit").click(function(){a("#tos").is(":checked")?(a("#step2Box").spin("small"),a("#step2Submit").attr("disabled","disabled"),a.post(mooConfig.url.base+"/users/ajax_signup_step2",a("#regForm").serialize(),function(b){a("#step2Box").spin(!1);var c="",e=!1;try{c=JSON.parse(b),e=!0}catch(g){}var f=mooConfig.url.base+"/";e&&c.redirect&&(f=c.redirect);e||""==b?(b={status:!1,sUrlRedirect:f},a("body").trigger("initOnRegistrationStep2Callback",
[b]),b.status||(window.location=f)):(a("#regError").fadeIn(),a("#regError").html(b),a("#step2Submit").removeAttr("disabled"),"undefined"!==typeof grecaptcha&&grecaptcha.reset())})):(a("#regError").fadeIn(),a("#regError").html(d.__("you_have_to_agree_with_term_of_service")))})},initOnSignupStep1:function(){new x.fineUploader({element:a("#profile_picture")[0],request:{endpoint:mooConfig.url.base+"/upload/avatar_tmp"},text:{uploadButton:'<div class="upload-section"><span class="upload-section-icon material-icons moo-icon moo-icon-photo_camera">photo_camera</span> '+
d.__("drag_or_click_here_to_upload_photo")+"</div>"},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},multiple:!1,callbacks:{onError:y.errorHandler,onComplete:function(b,c,e){a("#profile_picture_preview > img").attr("src",mooConfig.url.base+"/uploads/tmp/"+e.filename);a("#profile_picture_preview > img").show();a("#profile_picture_preview > img").css({height:"150px"});a("#avatar").val(e.filepath)}}})},initOnSignupStep1FieldCountry:function(){a("#country_id").unbind("change");
a("#country_id").change(function(){a(".country_city").hide();a(".country_state").hide();a("#state_id").html("<option value=''></option>");a("#city_id").html("<option value=''></option>");""!=a("#country").val()&&a.getJSON(mooConfig.url.base+"/countries/ajax_get_state/"+a("#country_id").val(),function(b){if(0<b.count){var c=0;a.each(b.data,function(e){0==c&&(c=b.data[e].id);a("#state_id").append("<option value='"+b.data[e].id+"'>"+b.data[e].name+"</option>")});1==b.data.length?(a("#state_id").val(c),
a("#state_id").trigger("change")):a(".country_state").show()}})});a("#state_id").unbind("change");a("#state_id").change(function(){a(".country_city").hide();a("#city_id").html("<option value=''></option>");""!=a("#state_id").val()&&a.getJSON(mooConfig.url.base+"/countries/ajax_get_city/"+a("#state_id").val(),function(b){0<b.count&&(a(".country_city").show(),a.each(b.data,function(c){a("#city_id").append("<option value='"+b.data[c].id+"'>"+b.data[c].name+"</option>")}))})})},initOnProfilePicture:function(){a("#save-avatar").unbind("click");
a("#save-avatar").click(function(){if(null==a("#avatar_wrapper img").data("default"))if(mooConfig.isMobile)c=a(this).data(),h.getCroppedCanvas().toBlob(function(e){var f=new FormData;f.append("croppedImage",e);a.ajax(mooConfig.url.base+"/upload/thumb_blob",{method:"POST",data:f,processData:!1,contentType:!1,success:function(){window.location=c.url},error:function(){console.log("Upload error")}})});else{var c=a(this).data();0==m&&0==n&&0==p&&0==q?u.alert(d.__("please_select_area_for_cropping")):(a("#avatar_wrapper").spin("large"),
a("#portlet-config"),a.post(mooConfig.url.base+"/upload/thumb",{x:m,y:n,w:p,h:q},function(e){a("#avatar_wrapper").spin(!1);""!=e&&(e=a.parseJSON(e),a("#member-avatar").attr("src",e.thumb),window.location=c.url)}))}});if(null==a("#avatar_wrapper img").data("default"))if(mooConfig.isMobile){a("#avatar_wrapper").spin("large");var b=document.querySelector("#av-img2");h=new z(b,{aspectRatio:1,zoomable:!1,viewMode:3,minCropBoxWidth:200,minCropBoxHeight:200,ready:function(){a("#avatar_wrapper").spin(!1)},
cropmove:function(){h=this.cropper;var c=h.getCropBoxData();console.log(c);m=c.left;n=c.top;p=c.width;q=c.height}})}else a("#av-img2").Jcrop({aspectRatio:1,onSelect:w,minSize:[200,200]},function(){A=this});new x.fineUploader({element:a("#select-0")[0],multiple:!1,text:{uploadButton:'<div class="upload-section"><span class="upload-section-icon material-icons moo-icon moo-icon-photo_camera">photo_camera</span>'+d.__("drag_or_click_here_to_upload_photo")+"</div>"},validation:{allowedExtensions:mooConfig.photoExt,
sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/upload/avatar"},callbacks:{onError:y.errorHandler,onComplete:function(c,e,f){a("#av-img").attr("src",f.avatar);a("#av-img2").attr("src",f.avatar);a("#member-avatar").attr("src",f.thumb);1==a("#avatar_wrapper img").data("default")&&(mooConfig.isMobile?(a("#avatar_wrapper").spin("large"),c=document.querySelector("#av-img2"),h=new z(c,{aspectRatio:1,zoomable:!1,viewMode:3,minCropBoxWidth:200,minCropBoxHeight:200,ready:function(){a("#avatar_wrapper").spin(!1)},
cropmove:function(){h=this.cropper;var g=h.getCropBoxData();console.log(g);m=g.left;n=g.top;p=g.width;q=g.height}})):a("#av-img2").Jcrop({aspectRatio:1,onSelect:w,minSize:[200,200]},function(){A=this}));a("#avatar_wrapper img").data("default",null);mooConfig.isMobile?h.replace(f.avatar):A.setImage(f.avatar);a(".avatar-rotate").show()}}});C(A)},initAddFriend:function(){a("#addFriendForm textarea").unbind("keyup");a("#addFriendForm textarea").keyup(function(){if(this.value.length>parseInt(a(this).attr("maxlength")))return!1;
a("#addFriendForm #message_count").html(parseInt(a(this).attr("maxlength"))-this.value.length)});a("#sendReqAddFriendBtn").unbind("click");a("#sendReqAddFriendBtn").click(function(){var b=a(this).data().uid;a("#sendReqAddFriendBtn").spin("small");k.disableButton("sendReqAddFriendBtn");a.post(mooConfig.url.base+"/friends/ajax_sendRequest",a("#addFriendForm").serialize(),function(c){a(".suggestion_block").length&&(a(".suggestion_block #addFriend_"+b).parents("li:first").remove(),0==a(".suggestion_block li").length&&
a(".suggestion_block").remove());k.enableButton("sendReqAddFriendBtn");a("#themeModal").modal("hide");a("#addFriend_"+b).parents("div.user-idx-item").append('<a href="'+mooConfig.url.base+"/friends/ajax_cancel/"+b+'" id="cancelFriend_'+b+'" class="add_people" title="'+d.__("cancel_a_friend_request")+'"><i class="material-icons">clear</i>'+d.__("cancel_request")+"</a>");a("#addFriend_"+b).remove();a("#blogAddFriend").length&&(a("#blogAddFriend").parents(".blog_view_leftnav").append('<li><a href="'+
mooConfig.url.base+"/friends/ajax_cancel/"+b+'" id="blogCancelFriend" class="" title="'+d.__("cancel_a_friend_request")+'"><i class="material-icons icon-small">clear</i>'+d.__("cancel_request")+"</a></li>"),a("#blogAddFriend").parents("li:first").remove());a("#userAddFriend").length&&(a("#userAddFriend").parents(".profile-action").append('<a id="userCancelFriend" href="'+mooConfig.url.base+"/friends/ajax_cancel/"+b+'" class="topButton button button-action" title="'+d.__("cancel_a_friend_request")+
'"><i class="visible-xs visible-sm material-icons">clear</i><i class="hidden-xs hidden-sm">'+d.__("cancel_request")+"</i></a>"),a("#userAddFriend").remove());location.reload()});return!1})},initBirthdayPopup:function(){a(".more-birthday-email").unbind("click");a(".more-birthday-email").click(function(){a("#langModal").modal("show")&&a("#langModal").modal("hide")});a(".postFriendWall").unbind("click");a(".postFriendWall").click(function(){var b=a(this).data("id"),c=a(this),e=a("#message_"+b).val();
""!=a.trim(e)&&(k.disableButton("status_btn_"+b),a.post(mooConfig.url.base+"/activities/send_birthday_wish",a("#wallForm_"+b).serialize(),function(f){f=a.parseJSON(f);k.enableButton("status_btn_"+b);a("#message_"+b).val("");f.success&&(k.enableButton("status_btn_"+b),c.parent().parent(".birthday-wish").html("<div style='padding:5px 0px;'>"+d.__("birthday_wish_is_sent")+"</div>"))}))})},initEditCoverPicture:function(){function b(g,l,t){window.URL=window.URL||window.webkitURL;g=t.getFile(g);var r=new FileReader;
r.readAsDataURL(g);r.onloadend=function(){var D=new Image,B={};D.onerror=function(I){B.error=d.__("cannot_determine_dimensions_for_image_may_be_too_large")};D.onload=function(){B={width:this.width,height:this.height};var I=B.height>=l[1];B.width>=l[0]&&I?f.uploadStoredFiles():(f.clearStoredFiles(),u.alert(d.__("please_choose_an_image_that_s_at_least_400_pixels_wide_and_at_least_150_pixels_tall")))};D.src=r.result}}var c;if(!mooConfig.isMobile&&null==a("#cover_wrapper img").data("default"))a("#cover-img").Jcrop({aspectRatio:4,
onSelect:w,minSize:[400,100],boxWidth:570},function(){c=this});else if(mooConfig.isMobile&&null==a("#cover_wrapper img").data("default")){a("#cover_wrapper").spin("large");var e=document.querySelector("#cover-img");h=new z(e,{aspectRatio:4,zoomable:!1,viewMode:3,minCropBoxWidth:400,minCropBoxHeight:100,ready:function(){a("#cover_wrapper").spin(!1)},cropmove:function(){h=this.cropper;var g=h.getCropBoxData();console.log(g);m=g.left;n=g.top;p=g.width;q=g.height}})}var f=new x.fineUploader({element:a("#select-1")[0],
multiple:!1,autoUpload:!1,text:{uploadButton:'<div class="upload-section"><span class="upload-section-icon material-icons moo-icon moo-icon-photo_camera">photo_camera</span>'+d.__("drag_or_click_here_to_upload_photo")+"</div>"},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/upload/cover"},callbacks:{onSubmit:function(g,l){return b(g,[400,100],this)},onError:y.errorHandler,onComplete:function(g,l,t){a("#cover_img_display").attr("src",
t.cover);a("#cover_img_background").css("background-image","url("+t.cover+")");mooConfig.isMobile||(a("#cover_wrapper img").attr("src",t.photo),a("#cover_wrapper img").attr("style",""),c&&c.destroy(),a("#cover-img").Jcrop({aspectRatio:4,onSelect:w,minSize:[400,100],boxWidth:570},function(){c=this}));mooConfig.isMobile&&null!=a("#cover_wrapper img").data("default")?(a("#cover_wrapper").spin("large"),a("#cover_wrapper img").attr("src",t.photo),g=document.querySelector("#cover-img"),h=new z(g,{aspectRatio:4,
zoomable:!1,viewMode:3,minCropBoxWidth:400,minCropBoxHeight:100,ready:function(){a("#cover_wrapper").spin(!1)},cropmove:function(){a("#cover_wrapper").spin(!1);h=this.cropper;var r=h.getCropBoxData();console.log(r);m=r.left;n=r.top;p=r.width;q=r.height}})):mooConfig.isMobile&&h.replace(t.photo);a("#cover_wrapper img").data("default",null)}}})},initEditProfilePicture:function(){var b;mooConfig.isMobile?(a(".modal-footer").addClass("hide"),C(b)):a("#av-img2").Jcrop({aspectRatio:1,onSelect:w,minSize:[200,
200],boxWidth:570},function(){b=this;C(b)});new x.fineUploader({element:a("#select-0")[0],multiple:!1,text:{uploadButton:'<div class="upload-section"><span class="upload-section-icon material-icons moo-icon moo-icon-photo_camera">photo_camera</span>'+d.__("drag_or_click_here_to_upload_photo")+"</div>"},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/upload/avatar"},callbacks:{onError:y.errorHandler,onComplete:function(c,e,f){a("#av-img").attr("src",
f.avatar_mini);mooConfig.isMobile?a("#avatar_wrapper img").attr("src",f.avatar):b.setImage(f.avatar);a("#member-avatar").attr("src",f.thumb);a(".avatar-rotate").show()}}})},initRemoveFriend:function(){a("#removeFriendButton").unbind("click");a("#removeFriendButton").click(function(){var b=a(this).data().uid;k.disableButton("removeFriendButton");a.post(mooConfig.url.base+"/friends/ajax_removeRequest",a("#removeFriendForm").serialize(),function(c){k.enableButton("removeFriendButton");a("#themeModal").modal("hide");
c=a("#removeFriend_"+b).parents("li:first");var e=c.parents('li[id^="activity_"]');c.remove();e.remove();location.reload()});return!1})},initOnProfileEdit:function(){a(".multi").multiSelect({selectAll:!1,noneSelected:"",oneOrMoreSelected:d.__("per_selected")});a("#username").keyup(function(){var b="";""!=a("#username").val().trim()&&(b="-"+a("#username").val().trim());a("#profile_user_name").html(b)});a("#checkButton").unbind("click");a("#checkButton").click(function(){M()})},initOnUserList:function(){a("#list-content li").hover(function(){a(this).contents().find(".delete-icon").show()},
function(){a(this).contents().find(".delete-icon").hide()});G();O();Q();F.initMoreResults()},initAjaxRequest:function(){a(".respondRequest").unbind("click");a(".respondRequest").on("click",function(){if(!v())return!1;a(this).addClass("disabled");var b=a(this).data();if(0<a("#friend_request_count").length){var c=a("#friend_request_count").html();c=parseInt(c-1);0>=c?a("#friend_request_count").parents("li:first").remove():a("#friend_request_count").html(c)}a.post(mooConfig.url.base+"/friends/ajax_respond",
{id:b.id,status:b.status},function(e){a("#request_"+b.id).html(e)})})},initAjaxRequestPopup:function(){a(".respondRequest").unbind("click");a(".respondRequest").on("click",function(){if(!v())return!1;a(this).addClass("disabled");var b=a(this).data();a.post(mooConfig.url.base+"/friends/ajax_respond",{id:b.id,status:b.status},function(c){a("#request_"+b.id).html(c);location.reload()})})},initShowAlbums:function(){a(".showAlbums").unbind("click");a(".showAlbums").on("click",function(){R(a(this).data("userId"))})},
initRespondRequest:G,initOnUserIndex:function(){a(".multi").multiSelect({selectAll:!1,noneSelected:"",oneOrMoreSelected:d.__("per_selected")});a("#searchPeople").unbind("click");a("#searchPeople").click(function(){a(".browse-menu").CoreBrowseMenuSpinStart("#browse_all");a.post(mooConfig.url.base+"/users/ajax_browse/search",a("#filters").serialize(),function(b){a(".browse-menu").CoreBrowseMenuSpinStop("#browse_all");a("#list-content").html(b);E.registerOverlay();a("body").trigger("afterSearchPeopleUserCallback",
[])});992>a(window).width()&&(a("#leftnav").sidebarModal("hide"),a("#right").sidebarModal("hide"),a("body").scrollTop(0))});a("body").on("afterAjaxSearchServerJSCallback",function(b,c){"users"==c.search_name&&E.registerOverlay()})},initOnUserProfile:function(){a(".deactiveMyAccount").unbind("click");a(".deactiveMyAccount").on("click",function(){u.confirm(d.__("confirm_deactivate_account"),mooConfig.url.base+"/users/deactivate")});a(".deleteMyAccount").unbind("click");a(".deleteMyAccount").on("click",
function(){u.confirm(d.__("confirm_delete_account"),mooConfig.url.base+"/users/delete_account")});a("#save_profile").click(function(b){b.preventDefault();button=a(this);button.addClass("disabled");J.post({url:mooConfig.url.base+"/users/ajax_save_profile",data:jQuery("#form_edit_user").serialize()},function(c){c=a.parseJSON(c);c.status?location.reload():(button.removeClass("disabled"),a(".error-message").show(),a(".error-message").html(c.message))});return!1})},initOnCloseNetworkSignup:function(b){a("#username").keyup(function(){var c=
"";""!=a("#username").val().trim()&&(c="-"+a("#username").val().trim());a("#profile_user_name").html(c)});a("#submitFormsignup").click(function(){a("#step1Box").spin("small");a("#submitFormsignup").attr("disabled","disabled");a.post(mooConfig.url.base+"/users/ajax_signup_step1",a("#regForm").serialize(),function(c){a("#step1Box").spin(!1);if(0<c.indexOf("mooError"))a("#regError").fadeIn(),a("#regError").html(c),a("#submitFormsignup").removeAttr("disabled");else{a("#regError").fadeOut();var e={status:!1,
data:c};a("body").trigger("initOnRegistrationStep1Callback",[e]);e.status||a("#regFields").append(c);a("#captcha").fadeIn();a("#step1Box").remove();a(".tip").tipsy({html:!0,gravity:"s"});a(".multi").multiSelect({selectAll:!1,noneSelected:"",oneOrMoreSelected:d.__("per_selected")})}})});a("#step2Submit").click(function(){a("#tos").is(":checked")?(a("#step2Box").spin("small"),a("#step2Submit").attr("disabled","disabled"),a.post(mooConfig.url.base+"/users/ajax_signup_step2",a("#regForm").serialize(),
function(c){a("#step2Box").spin(!1);var e="",f=!1;try{e=JSON.parse(c),f=!0}catch(l){}var g=mooConfig.url.base+"/";f&&e.redirect&&(g=e.redirect);f||""==c?(c={status:!1,sUrlRedirect:g},a("body").trigger("initOnRegistrationStep2Callback",[c]),c.status||(window.location=g)):(a("#regError").fadeIn(),a("#regError").html(c),a("#step2Submit").removeAttr("disabled"),b&&grecaptcha.reset())})):(a("#regError").fadeIn(),a("#regError").html(d.__("you_have_to_agree_with_term_of_service")))})},resendValidationLink:function(){a("#resend_validation_link").unbind("click");
a("#resend_validation_link").on("click",function(){a.post(mooConfig.url.base+"/users/resend_validation",{},function(b){u.alert(d.__("validation_link_has_been_resend"))})})},initOnSocialRegistration:function(b,c){a("#username").keyup(function(){var e="";""!=a("#username").val().trim()&&(e="-"+a("#username").val().trim());a("#profile_user_name").html(e)});a(".multi").multiSelect({selectAll:!1,noneSelected:"",oneOrMoreSelected:d.__("per_selected")});a("#step2Submit").click(function(){a("#tos").is(":checked")?
(a("#step2Box").spin("small"),a("#step2Submit").attr("disabled","disabled"),a.post(mooConfig.url.base+"/social/auths/ajax_signup_step2/"+c,a("#regForm").serialize(),function(e){a("#step2Box").spin(!1);var f="",g=!1;try{f=JSON.parse(e),g=!0}catch(l){g=!1}g?f.redirect&&(window.location=f.redirect):""!=e?(a("#regError").fadeIn(),a("#regError").html(e),a("#step2Submit").removeAttr("disabled"),b&&grecaptcha.reset()):window.location=mooConfig.url.base+"/"})):(a("#regError").fadeIn(),a("#regError").html(d.__("you_have_to_agree_with_term_of_service")))})},
initOnUserView:function(){a("#themeModal").on("click"," .save-avatar",function(){a("#avatar_wrapper").spin("large");var b=a("#themeModal");a.post(mooConfig.url.base+"/upload/thumb",{x:m,y:n,w:p,h:q},function(c){b.modal("hide");""!=c&&(c=a.parseJSON(c),a("#member-avatar").attr("src",c.thumb),a("#av-img").attr("src",c.avatar_mini),a("body").trigger("afterSaveAvatarSuccess",[{avatar:c}]))})});a("#themeModal").on("click"," .save-cover",function(){var b=a("#themeModal");a("#cover_wrapper").spin("large");
if(mooConfig.isMobile&&null==a("#cover_wrapper img").data("default"))console.log(h),h.getCroppedCanvas().toBlob(function(f){var g=new FormData;g.append("croppedImage",f);a.ajax(mooConfig.url.base+"/upload/thumb_cover_blob",{method:"POST",data:g,processData:!1,contentType:!1,success:function(l){b.modal("hide");""!=l&&(l=a.parseJSON(l),a("#cover_img_display").attr("src",l.thumb),a("#cover_img_background").css("background-image","url("+l.thumb+")"),a("body").trigger("afterSaveCoverSuccess",[{cover:l}]))},
error:function(){console.log("Upload error")}})});else{var c=a("#cover_wrapper .jcrop-holder").width(),e=a("#cover_wrapper .jcrop-holder").height();a.post(mooConfig.url.base+"/upload/thumb_cover",{x:m,y:n,w:p,h:q,jcrop_width:c,jcrop_height:e},function(f){b.modal("hide");""!=f&&(f=a.parseJSON(f),a("#cover_img_display").attr("src",f.thumb),a("#cover_img_background").css("background-image","url("+f.thumb+")"),a("body").trigger("afterSaveCoverSuccess",[{cover:f}]))})}})},initBlockUser:function(){a("#blockUserButton").unbind("click");
a("#blockUserButton").click(function(){a("#blockUserButton").spin("small");k.disableButton("blockUserButton");a.post(mooConfig.url.base+"/user_blocks/ajax_do_add",a("#blockUserForm").serialize(),function(b){k.enableButton("blockUserButton");a("#themeModal").modal("hide");window.location.href=mooConfig.url.base+"/"});return!1})},initUnBlockUser:function(){a("#unBlockUserButton").unbind("click");a("#unBlockUserButton").click(function(){a("#unBlockUserButton").spin("small");k.disableButton("unBlockUserButton");
a.post(mooConfig.url.base+"/user_blocks/ajax_do_remove",a("#unBlockUserForm").serialize(),function(b){k.enableButton("unBlockUserButton");a("#themeModal").modal("hide");location.reload()});return!1})},initRemoveFollow:function(){a("#removeFollowButton").unbind("click");a("#removeFollowButton").click(function(){a(this).data();k.disableButton("removeFollowButton");a.post(mooConfig.url.base+"/follows/ajax_removeRequest",a("#removeFollowForm").serialize(),function(b){k.enableButton("removeFollowButton");
a("#themeModal").modal("hide");a("#profile_follow").click();b=parseInt(a("#profile_follow .badge_counter").html());b--;a("#profile_follow .badge_counter").html(b)});return!1})},initSearchFriend:function(b){a("#form_friend_search").submit(function(c){c.preventDefault();return!1});a("#form_friend_search").find(".friend_search_btn").click(function(c){H(b)});a("#search_friend").unbind("keyup");a("#search_friend").keyup(function(){H(b)})},loadProfileType:function(b){a(".core_profile_type_id").unbind("change").change(function(){var c=
a(this).val(),e=a(this).attr("data-for"),f=a(e);a.get(mooConfig.url.base+"/users/ajax_loadfields/"+c+"/"+b,function(g){f.html(g);a(".multi").multiSelect({selectAll:!1,noneSelected:"",oneOrMoreSelected:d.__("per_selected")});a("body").trigger("afterChangeProfileTypeUserCallback",[{data_for:e}])})})}}});