!function(e,i){"function"==typeof define&&define.amd?define(["jquery","mooButton","mooOverlay","mooResponsive","mooAjax","mooAlert","spinner"],i):"object"==typeof exports?module.exports=i(require("jquery"),require("button")):e.mooBehavior=i()}(this,function(e,i,n,t,o,r){var a=!0,l=function(){e(".view-more .viewMoreBtn").unbind("click"),e(".view-more .viewMoreBtn").click(function(){var i=e(this).data();m(i.url,i.div,this)}),e(".view-more-chrono .viewMoreBtn").unbind("click"),e(".view-more-chrono .viewMoreBtn").click(function(){var i=e(this).data();u(i.url,i.div,this)})},s=function(){e(".view-more .viewMoreBtn").unbind("click"),e(".view-more .viewMoreBtn").click(function(){var i=e(this).data();c(i.url,i.div,this)})},c=function(i,n,t){e(t).spin("small"),e(t).parent().css("display","none"),e.post(mooConfig.url.base+i,"",function(i){e(t).spin(!1),e("#"+n).find(".view-more:first").remove(),e("#"+n).children(".clear:first").remove(),e("#"+n).find(".loading:first").remove(),e("#"+n).append(i),s()})},m=function(i,o,r){e(r).spin("small"),e(r).parent().css("display","none"),void 0===window.searchParams&&(window.searchParams=""),e.post(mooConfig.url.base+i,window.searchParams,function(i){e(r).spin(!1),e("#"+o).find(".view-more:first").remove(),e("#"+o).children(".clear:first").remove(),e("#"+o).find(".loading:first").remove(),a=!0,"comments"==o||"theaterComments"==o?(e("#"+o).append(i),e("#"+o+" .view-more").insertAfter("#"+o+' li[id^="itemcomment_"]:last')):e("#"+o).append(i),n.registerOverlay(),g(),e(".tip").tipsy({html:!0,gravity:"s"}),window.initShareBtn(),t.initFeedImage(),l(),e("body").trigger("afterMoreResultsBehaviorCallback",[])})},u=function(i,o,r){e(r).spin("small"),e(r).parent().css("display","none"),void 0===window.searchParams&&(window.searchParams=""),e.post(mooConfig.url.base+i,window.searchParams,function(i){e(r).spin(!1),e("#"+o).find(".view-more:first").remove(),e("#"+o).children(".clear:first").remove(),e("#"+o).find(".loading:first").remove(),a=!0,"comments"==o||"theaterComments"==o?(e("#"+o).prepend(i),e("#"+o+" .view-more").insertAfter("#"+o+' li[id^="itemcomment_"]:last')):e("#"+o).prepend(i),n.registerOverlay(),g(),e(".tip").tipsy({html:!0,gravity:"s"}),window.initShareBtn(),t.initFeedImage(),l(),e("body").trigger("afterMoreResultsBehaviorCallback",[])})},g=function(){e(".comment_thumb a").length&&e(".comment_thumb a").magnificPopup({type:"image",gallery:{enabled:!1},zoom:{enabled:!0,opener:function(e){return e}}})},d=[];function f(i){var n=mooConfig.FeedPluginConfig[i];0!=n.length&&e("body").trigger("enablePluginsCallback",[{plugins:n}])}function p(i){var n=mooConfig.FeedPluginConfig[i];0!=n.length&&e("body").trigger("disablePluginsCallback",[{plugins:n}])}function h(){if(0!=d.length)for(var e=0;e<d.length;e++)p(d[e])}return{initAutoLoadMore:function(){""!=mooConfig.autoLoadMore&&e(window).scroll(function(){var i=e(".view-more");if(i.length>0){var n=e(window),t=n.scrollTop(),o=t+n.height(),r=i.offset().top;r+i.height()<=o&&r>=t&&a&&0==e(".shepherd-element").length&&(i.before('<div style="text-align: center" class="loading"><img src="'+mooConfig.url.base+'/img/loading.gif" /></div>'),i.find("a").trigger("click"),a=!1)}})},createItem:function(n,t){i.disableButton("saveBtn");var r="ajax_save";t&&(r="save"),o.post({url:mooConfig.url.base+"/"+n+"/"+r,data:e("#createForm").serialize()},function(t){var o=e.parseJSON(t);1==o.result?window.location=mooConfig.url.base+"/"+n+"/view/"+o.id:(i.enableButton("saveBtn"),e(".error-message").show(),e(".error-message").html(o.message),e(".spinner").length>0&&e(".spinner").remove())})},initMoreResults:l,initMoreResultsPopup:s,toggleCheckboxes:function(i){i.checked?e(".check").attr("checked","checked"):e(".check").attr("checked",!1)},toggleMenu:function(i){"leftnav"==i?"-200px"==e("#leftnav").css("left")?(e("#leftnav").animate({left:0},300),e("#right").animate({right:-204},300),e("#center").animate({left:200},300)):(e("#leftnav").animate({left:-200},300),e("#center").animate({left:0},300)):"-204px"==e("#right").css("right")?(e("#right").show(),e("#right").animate({right:0},300),e("#leftnav").animate({left:-200},300),e("#center").animate({left:0},300)):e("#right").animate({right:-204},300,function(){e("#right").hide()})},registerImageComment:g,registerEventThumb:function(){e(".event-detail-thumb").length&&e(".event-detail-thumb").magnificPopup({type:"image",gallery:{enabled:!1},zoom:{enabled:!0,opener:function(e){return e}}})},initOnReportItem:function(){return e("#reportButton").unbind("click"),e("#reportButton").click(function(){i.disableButton("reportButton"),e("#reportButton").spin("small"),o.post({url:mooConfig.url.base+"/reports/ajax_save",data:e("#reportForm").serialize()},function(n){i.enableButton("reportButton"),e("#reportButton").spin(!1);var t=e.parseJSON(n);1==t.result?(e(".error-message").hide(),e("#reason").val(""),e("#reason").trigger("updateAutoGrow"),r.alert(t.message),e("#portlet-config").modal("hide"),e("#themeModal").modal("hide")):(e(".error-message").show(),e(".error-message").html(t.message))})}),!1},initFeedForm:function(){e("body").on("startFeedPlugin3drCallback",function(i,n){-1==d.indexOf(n.plugin_name)&&(d.push(n.plugin_name),p(n.plugin_name),e("body").trigger("listFeedPlugin3drEnableCallback",[{plugins:d}]),e("body").trigger("checkActivityFormActionCallback"))}),e("body").on("stopFeedPlugin3drCallback",function(i,n){var t=d.indexOf(n.plugin_name);t>-1&&(f(n.plugin_name),d.splice(t,1),h(),e("body").trigger("listFeedPlugin3drEnableCallback",[{plugins:d}]),e("body").trigger("checkActivityFormActionCallback"))}),e("body").on("refreshFeedPlugin3drCallback",function(i,n){var t=d.indexOf(n.plugin_name);"add"===n.status?-1==t&&(d.push(n.plugin_name),p(n.plugin_name),e("body").trigger("checkActivityFormActionCallback")):"remove"===n.status&&t>-1&&(d.splice(t,1),f(n.plugin_name),h(),e("body").trigger("checkActivityFormActionCallback"))})}}});