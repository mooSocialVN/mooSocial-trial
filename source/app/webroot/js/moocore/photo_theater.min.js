(function(a,k){"function"===typeof define&&define.amd?define("jquery mooPhrase mooMention mooToggleEmoji mooBehavior mooAlert mooTooltip mooUser elastislide".split(" "),k):"object"===typeof exports?module.exports=k(require("jquery")):a.mooPhotoTheater=k()})(this,function(a,k,aa,ba,ca,I,u,da){function v(){var b=a("#photo_src");a(window).height();if(b.data("size")&&""!=b.data("size")){tmp=b.data("size").split(",");var c=tmp[0];var d=tmp[1]}c&&d?J(b,c,d):a("<img/>").attr("src",a(b).attr("src")).load(function(){c=
this.width;d=this.height;J(b,c,d);a.post(mooConfig.url.base+"/photos/ajax_update_size",{photo_id:e,width:c,height:d})})}function w(){var b=a("#preload").html();""!=b&&(a("#preload").html(""),element=a("<div>"+b+"</div>"),data=element.find("#photo_wrapper").data(),e=data.photoid,h=data.taguid,g=data.taguserid,m=data.nextphoto,x=data.thumbfull,a("#photo-content #tag-wrapper").hide(),a("#photo-content .photo_comments").hide(),element.find(".photo_comments").html()&&(a("#photo-content .photo_comments").html(element.find(".photo_comments").html()),
a("#photo-content .photo_comments").show()),a("#photo_wrapper .info").html(element.find(".info").html()),a("#photo-content #tag-wrapper").html(element.find("#tag-wrapper").html()),a("#photo-content #lb_description").html(""),a("#photo-content #lb_description").html(element.find("#lb_description").html()),a("#photo_wrapper").spin("large"),K(),v())}function ea(b,c){"1"==c&&a("#thumb_list_popup").is(":visible")&&p.setCurrent(a("#photo_thumb_"+b).index());a("#theaterPhotoComment").destroyOverlayInstance(a("#theaterPhotoComment"));
e=b;a("#thumb_list_popup .active").removeClass("active");a("#photo_thumb_"+e).addClass("active");a("#photo_wrapper").spin("large");var d="";d=h?b+"/uid:"+h:b;d=d+"/time/"+(new Date).getTime();d=g?d+("?uid="+g+"&theater"):d+"?theater";a("#preload").load(mooConfig.url.base+"/photos/ajax_view_theater/"+d,{noCache:0},function(){l=!1;a("#photoModal .slimScrollDiv").attr("style","");a("#theaterComments").attr("style","");w();u.init()})}function L(b,c){"1"==c&&a("#thumb_list_popup").is(":visible")&&p.setCurrent(a("#photo_thumb_"+
b).index());a("#theaterPhotoComment").destroyOverlayInstance(a("#theaterPhotoComment"));e=b;a("#thumb_list_popup .active").removeClass("active");a("#photo_thumb_"+e).addClass("active");a("#photo_wrapper").spin("large");var d="";d=h?b+"/uid:"+h:b;var f=d+"/time/"+(new Date).getTime();g?(f+="?uid="+g+"&pid="+b+"&theater",d+="?uid="+g+"&pid="+b+"&theater"):(f+="?pid="+b+"&theater",d+="?pid="+b+"&theater");a("#preload").load(mooConfig.url.base+"/photos/ajax_view_theater/"+f,{noCache:0},function(){l=!1;
a("#photoModal .slimScrollDiv").attr("style","");a("#theaterComments").attr("style","");w();u.init()});window.history.pushState({photo_id:e},"",mooConfig.url.base+"/photos/view/"+d)}var e,M=!1,p,N=!1,O,y=!0,x,z,P=!1,l=!1,fa=0,m="",Q,A=!1,q,r,B,C,D,E,F,G,h=0,g=0,J=function(b,c,d){d>=c?a(b).addClass("verticalImagePopup"):d<f-72?a(b).addClass("horizionImagePopup"):a(b).addClass("verticalImagePopup");0<a("#theaterPhotoComment").length&&(aa.init("theaterPhotoComment"),ba.init("theaterPhotoComment",'<span class="post-area-icon material-icons moo-icon moo-icon-mood">mood</span>'));
a("#photo_wrapper").spin(!1);a("#tag-wrapper").show();a("#photo_src").css("visibility","visible");if(992<a(window).width()){var f=a(window).height();b=a("#photo_wrapper").width();a("#photoModal #tag-wrapper").height(f-72);a("#photoModal #tag-wrapper .photo_img").height(f-72);a("#photoModal #tag-wrapper").width(b);a("#photoModal .photo_comments").height(f)}else f=a(window).height(),b=a(window).width(),a("#photoModal #tag-wrapper").height(f-36),a("#photoModal #tag-wrapper .photo_img").height(f-36),
a("#photoModal #tag-wrapper").width(b)},ha=function(){a(".photoDetailTags").on("mouseout",function(){var b=a(this).data();R("0-"+b.tagId)}).on("mouseover",function(){var b=a(this).data();S("0-"+b.tagId)})},T=function(){0<a("#tags").find(".photoDetailTags").length?a("#tags").show():a("#tags").hide()},ia=function(){a(".photoDetailRemoveTags").unbind("click");a(".photoDetailRemoveTags").on("click",function(){var b=a(this).data();U("0-"+b.id,b.id)})},V=function(){a(".showPhotoTheater").unbind("click");
a(".showPhotoTheater").on("click",function(){var b=a(this).data();L(b.id,b.thumb)});ja();ha();ia()},ja=function(){a(window).unbind("popstate");a(window).on("popstate",function(){isTheater=W("theater",window.location);!1!==isTheater?(e=W("pid",window.location),ea(e,"1")):a("#photoModal").modal("hide")})},W=function(b,c){for(var d=c.search.substring(1).split("&"),f=0;f<d.length;f++){var n=d[f].split("=");if(n[0]==b)return"undefined"==typeof n[1]?"":n[1]}return!1},Y=function(b){a.post(mooConfig.url.base+
"/photos/ajax_thumb_theater/"+e+"/"+b+(g?"?uid="+g:""),function(c){a("#photo_thumbs ul").append(c);b==O?X():Y(b+1)})},ka=function(){a(document).on("click","a.photoModal",function(b){!mooConfig.force_login||mooConfig.photo_consider_force||da.validateUser()?M&&(b.preventDefault(),a("body").append('<div class="photo_modal_loading"></div>'),a(".photo_modal_loading").spin("large"),a.ajax({url:a(this).attr("href"),success:function(c){a("#photoModal .modal-content").html(c);a("#photoModal").modal("show");
u.init()}})):b.preventDefault()})},la=function(){a("#photoModal").on("shown.bs.modal",function(b){a(".photo_modal_loading").remove();Z();v();y&&X()});a("#photoModal").on("hidden.bs.modal",function(b){history.pushState({},"",z);a("#photoModal .modal-content").html("");a("#photoModal").removeData("bs.modal")})},Z=function(){e=a("#photo_wrapper").data("photoid");h=a("#photo_wrapper").data("taguid");g=a("#photo_wrapper").data("taguserid");m=a("#photo_wrapper").data("nextphoto");x=a("#photo_wrapper").data("thumbfull");
var b,c,d=a("#photo_wrapper").data("photocount"),f=a("#photo_wrapper").data("page");d>20*f?(O=Math.ceil(d/20),a("#photo_thumbs").spin(),a("#thumb_list_popup").hide(),y=!1,Y(2)):y=!0;N||(a(window).resize(function(){0==a("#photo-content").length||a("#theaterPhotoComment").is(":focus")||(992<a(window).width()?(b=a(window).height(),c=a("#photo_wrapper").width(),a("#photoModal #tag-wrapper").height(b-72),a("#photoModal #tag-wrapper .photo_img").height(b-72),a("#photoModal #tag-wrapper").width(c),a("#photoModal .photo_comments").height(b)):
(b=a(window).height(),c=a(window).width(),a("#photoModal #tag-wrapper").height(b-36),a("#photoModal #tag-wrapper .photo_img").height(b-36),a("#photoModal #tag-wrapper").width(c)),v(),a("#photo_src").css("visibility","visible"))}),a(document).keydown(function(n){a("#theaterPhotoComment").is(":focus")||a('[id^="message_item_comment_edit"]').is(":focus")||(37==n.keyCode?a("#photo_left_arrow_lg").trigger("click"):39==n.keyCode&&a("#photo_right_arro_lgw").trigger("click"))}),N=!0);a("#photo_thumbs ul li").unbind("click");
a("#photo_thumbs ul li").click(function(){a("#photo_thumbs ul li").removeClass("active");a(this).addClass("active")});a("#photo_wrapper").spin("large");a("#tag-wrapper").hide();url=h?e+"/uid:"+h+"?pid="+e+"&theater":g?e+"?uid="+g+"&pid="+e+"&theater":e+"?pid="+e+"&theater";z=window.location.href;window.history.pushState({photo_id:e},"",mooConfig.url.base+"/photos/view/"+url);window.history.replaceState({photo_id:e},"",mooConfig.url.base+"/photos/view/"+url);Q=window.location;K()},K=function(){a("#photo_wrapper .toogleThumb").unbind("click");
a("#photo_wrapper .toogleThumb").click(function(){a("#photo_thumbs").toggle();a("#thumb_list_popup").is(":visible")&&p.setCurrent(a("#photo_thumb_"+e).index())});a("#set_photo_cover").unbind("click");a("#set_photo_cover").click(function(){ma()});l=!1;a("#tagPhoto").unbind("click");a("#tagPhoto").click(function(){l?(l=!1,a("#tag-wrapper img").css("cursor","default"),a("#tagPhoto a").html(k.__("tag_photo")),a("#tag-name").unbind(),a("#tag-submit").unbind(),H()):na()});a("#set_profile_picture").unbind("click");
a("#set_profile_picture").click(function(){oa()});a("#delete_photo").unbind("click");a("#delete_photo").click(function(){m=""!=m?m:"0";I.confirm(k.__("are_you_delete"),mooConfig.url.base+"/photos/ajax_remove/photo_id:"+e+"/next_photo:"+m)});a("#photo_close_icon").unbind("click");a("#photo_close_icon").click(function(){history.pushState({},"",z)});a(".sharethis_theater").hideshare({media:x,linkedin:!1,link:Q});ca.registerImageComment();var b=500;mooConfig.isMobile&&(b=300);a("#theaterComments").height()>
b&&a("#theaterComments").slimScroll({height:b+"px",start:"top"}).bind("slimscroll",function(c,d){"bottom"==d&&""!=mooConfig.autoLoadMore&&0<a("#photoModal .view-more").length&&(a("#photoModal .view-more").before('<div style="text-align: center" class="loading"><img src="'+mooConfig.url.base+'/img/loading.gif" /></div>'),a("#photoModal .view-more").find("a").trigger("click"))});a("#theaterPhotoComment").autogrow()},H=function(){a("#tag-target").fadeOut();a("#tag-input").fadeOut();a("#tag-name").val("")},
na=function(){l=!0;a("#tag-wrapper img").css("cursor","crosshair");a("#tagPhoto a").html(k.__("done_tagging"));a("#tag-wrapper img").unbind("click");a("#tag-wrapper img").click(function(b){l&&(B=b.pageX-a("#tag-wrapper").offset().left,C=b.pageY-a("#tag-wrapper").offset().top,D=a("#tag-target").outerWidth(),E=a("#tag-target").outerHeight(),q=B-D/2,r=C-E/2,F=B+D/2,G=C-E/2,"block"==a("#tag-target").css("display")?(a("#tag-target").animate({left:q,top:r},500),a("#tag-input").animate({left:F,top:G},500)):
(a("#tag-target").css({left:q,top:r}).fadeIn(),a("#tag-input").css({left:F,top:G}).fadeIn()),a("#tag-name").focus(),a("#friends_list").html(a("#friends").html()),a(".tagFriends").unbind("click"),a(".tagFriends").on("click",function(){var c=a(this).data();t(c.id,c.tagValue)}))});a("#tag-cancel").unbind("click");a("#tag-cancel").click(function(){H();return!1});a("#tag-name").keyup(function(b){13==b.keyCode&&t(0,"")});a("#tag-submit").unbind("click");a("#tag-submit").click(function(){t(0,"");return!1})},
t=function(b,c){if(""!=b||""!=a("#tag-name").val()){var d="left:"+q+"px; top:"+r+"px";a("#photo_wrapper").spin("large");a.post(mooConfig.url.base+"/photos/ajax_tag",{photo_id:e,uid:b,value:a("#tag-name").val(),style:d},function(f){a("#photo_wrapper").spin(!1);f=a.parseJSON(f);1==f.result?(c=b?'<a href="'+mooConfig.url.base+"/users/view/"+b+'">'+c+"</a>":a("#tag-name").val(),a("#tags").find(".photo-list-tags").append('<span id="hotspot-item-0-'+f.id+'" data-tag-id="'+f.id+'" class="photoDetailTags">'+
c+'<a href="javascript:void(0)" class="photoDetailRemoveTags" data-id="'+f.id+'"><i class="material-icons cross-icon-sm">clear</i></a></span>'),a("#tag-wrapper .photo_img").append('<div id="hotspot-0-'+f.id+'" class="hotspot" style="'+d+'"><span>'+c+"</span></div>"),H(),fa++,V(),T()):I.alert(f.message)})}},U=function(b,c){a("#hotspot-item-"+b).remove();a("#hotspot-"+b).remove();T();a.post(mooConfig.url.base+"/photos/ajax_remove_tag",{tag_id:c})},S=function(b){a("#hotspot-"+b).addClass("hotspothover")},
R=function(b){a("#hotspot-"+b).removeClass("hotspothover")},X=function(){A=!1;p=a("#thumb_list_popup").elastislide({minItems:2,onReady:function(){p.setCurrent(a("#photo_thumb_"+e).index());a("#photo_thumbs").spin(!1);a("#photo_thumbs").css("visibility","visible");A||(A=!0,a("#photo_thumbs").toggle())}});a("#photo_thumb_"+e).addClass("active")},ma=function(){a("#set_cover").spin("custom");a.post(mooConfig.url.base+"/users/set_photo_as_cover",{photo_id:e},function(b){b=a.parseJSON(b);location.assign(b.url)})},
oa=function(){a("#set_avatar").spin("custom");a.post(mooConfig.url.base+"/users/set_photo_as_profile_picture",{photo_id:e},function(b){b=a.parseJSON(b);window.location=b.url})};return{init:function(){P||la();P=!0;ka()},initShowPhoto:V,start:function(){Z()},submitTag:function(b,c){t(b,c)},removeTag:function(b,c){U(b,c)},hideTag:function(b){R(b)},showTag:function(b){S(b)},showPhotoWrapper:function(){w()},showPhoto:function(b,c){"undefined"==typeof c&&(c=!1);L(b,c)},setActive:function(b){M=b}}});