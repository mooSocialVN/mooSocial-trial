!function(e,o){"function"==typeof define&&define.amd?define(["jquery","mooOverlay","mooBehavior","mooResponsive","mooShare","mooNotification","mooPhoto","mooUser","mooCoreMenu","tipsy","autogrow","spinner"],o):"object"==typeof exports?module.exports=o(require("jquery")):e.ServerJS=o(e.jQuery)}(this,function(u,p,e,o,a,t,r,i,n){var s=function(){u(".accept-cookie").unbind("click"),u(".accept-cookie").on("click",function(){var e=u(this).data("answer");u(this);u.post(mooConfig.url.base+"/users/accept_cookie",{answer:e},function(e){(e=JSON.parse(e)).result?(u(".cookies-warning").remove(),u("body").removeClass("page_has_cookies")):location.href=e.url})}),u(".delete-warning-cookies").unbind("click"),u(".delete-warning-cookies").on("click",function(){u(".cookies-warning").remove(),u("body").removeClass("page_has_cookies")})},c=function(e){u(e).prev().css("max-height","none");var o=u('<a href="javascript:void(0)" class="show-more">'+u(e).prev().data("less-text")+"</a>");u(e).replaceWith(o),o.click(function(e){l(this)}),u("body").trigger("afterShowMoreServerJSCallback",[])},l=function(e){u(e).prev().css("max-height","");var o=u('<a href="javascript:void(0)" class="show-more">'+u(e).prev().data("more-text")+"</a>");u(e).replaceWith(o),o.click(function(e){c(this)}),u("body").trigger("afterShowMoreServerJSCallback",[])},h=function(){500<u(".suggestionInitSlimScroll").height()&&u(".suggestionInitSlimScroll").slimScroll({height:"500px"}),u("#global-search").keyup(function(e){var o=u(this).val();""!=o&&u.post(mooConfig.url.base+"/search/suggestion/all",{searchVal:o},function(e){u(".global-search .slimScrollDiv").show(),u("#display-suggestion").html(e).show()}),"13"==e.keyCode&&""!=u(this).val()&&(e=u(this).val().replace("#",""),-1<u(this).val().indexOf("#")?window.location=mooConfig.url.base+"/search/hashtags?q="+encodeURIComponent(e):window.location=mooConfig.url.base+"/search/index?q="+encodeURIComponent(e))}),u("#global-search").focusout(function(e){0==u("#display-suggestion").is(":hover")&&(u("#display-suggestion").html("").hide(),u(".global-search .slimScrollDiv").hide())}),u("#global-search").focus(function(e){u("#global-search").trigger("keyup")}),u("#globalSearchBtnMobile").click(function(e){e.preventDefault(),u(this).parent().addClass("search-mobile-open"),u("#global-search").focus(),u("html").addClass("mobile-search-open")}),u("#globalSearchOverview").click(function(e){e.preventDefault(),u(this).parent().removeClass("search-mobile-open"),u("html").removeClass("mobile-search-open")}),u("#globalSearchCancel").click(function(e){e.preventDefault(),u(this).parent().parent().removeClass("search-mobile-open"),u("html").removeClass("mobile-search-open")})},m=function(){u("#form_main_search").find(".header_search_btn").click(function(e){u("#form_main_search").submit()}),u("#form_main_search").submit(function(e){var o,a=u(this),t=a.attr("search-type"),r=a.attr("method"),i=a.attr("action"),n="",s="#list-content",c={},l=a.find("#keyword"),h="";0<l.length&&(h=l.attr("rel")),void 0===i||""==i?""!=h&&(o="ajax_browse",l.hasClass("json-view")&&(o="browse"),s="albums"==l.attr("rel")?"#album-list-content":"#list-content",n=mooConfig.url.base+"/"+h+"/"+o+"/search/"+encodeURI(l.val()+"")):n=i,("POST"==r.toUpperCase()||0<a.find(".search-popup-open").length)&&(c=a.serialize()),"ajax"==t&&""!=n&&(e.preventDefault(),u.ajax({url:n,type:r.toUpperCase(),dataType:"html",cache:!1,data:c,beforeSend:function(){u(".browse-menu").CoreBrowseMenuSpinStart(),window.history.pushState({},"",u("#browse_all").find("a.horizontal-menu-link").attr("href"))}}).done(function(e){u(s).html(e),u(".browse-menu").CoreBrowseMenuSpinStop(),l.val(""),u(".tip").tipsy({html:!0,gravity:"s"}),p.registerOverlay(),u("body").trigger("afterAjaxSearchServerJSCallback",[{search_name:h}])}))})},d=function(){u("#appearance").change(function(){var e=0,e=u(this).is(":checked")?1:0;u("#appearanceMode").spin("tiny"),u("#appearance").attr("disabled","disabled"),u.post(mooConfig.url.base+"/users/ajax_appearance",{dark_mode:e},function(e){u("#appearanceMode").spin(!1),window.location.reload()})})};return{init:function(){u("textarea:not(.no-grow)").autogrow(),u(".tip").tipsy({html:!0,gravity:u.fn.tipsy.autoNS,follow:"x"}),u(".truncate").each(function(){var e;145<=parseInt(u(this).css("height"))&&(e=u('<a href="javascript:void(0)" class="show-more">'+u(this).data("more-text")+"</a>"),u(this).after(e),e.click(function(e){c(this)}))}),u(".comment-truncate").each(function(){var e;45<=parseInt(u(this).css("height"))&&(e=u('<a href="javascript:void(0)" class="show-more">'+u(this).data("more-text")+"</a>"),u(this).after(e),e.click(function(e){c(this)}))}),p.registerOverlay(),e.registerImageComment(),m(),s(),h(),o.init(),t.init(),a.init(),e.initMoreResults(),r.init(),e.initAutoLoadMore(),u(".browse-menu").CoreBrowseMenu({asCoreBrowseMenuFor:".browse-menu",asHorizontalMenuFor:".core-horizontal-menu"}),u("body").on("afterAjaxCoreBrowseMenuCallback",function(e,o){u("textarea:not(.no-grow)").autogrow(),u(".tip").tipsy({html:!0,gravity:"s"}),p.registerOverlay()}),u(".browse_menu-dropdown").CategoryMenuDropdown(),i.resendValidationLink(),d(),u("body").append('<input type="hidden" id="url_path" value="'+window.location.pathname+'">')}}});