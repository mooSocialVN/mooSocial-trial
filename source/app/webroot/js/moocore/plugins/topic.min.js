(function(a,f){"function"===typeof define&&define.amd?define("jquery mooBehavior mooFileUploader mooAjax mooOverlay mooAlert mooPhrase mooGlobal tinyMCE mooUser".split(" "),f):"object"===typeof exports?module.exports=f(require("jquery")):a.mooTopic=f()})(this,function(a,f,m,t,u,v,l,n,h,p){var k=function(){a(".deleteTopic").unbind("click");a(".deleteTopic").click(function(){var b=a(this).data();b=mooConfig.url.base+"/topics/do_delete/"+b.id;v.confirm(l.__("are_you_sure_you_want_to_remove_this_topic"),
b)})};return{initOnCreate:function(){a("#saveBtn").unbind("click");a("#saveBtn").click(function(){a(this).addClass("disabled");null!==h.activeEditor&&a("#editor").val(h.activeEditor.getContent());f.createItem("topics",!0)});var b=new m.fineUploader({element:a("#attachments_upload")[0],autoUpload:!1,text:{uploadButton:'<div class="upload-section"><span class="upload-section-icon material-icons moo-icon moo-icon-photo_camera">photo_camera</span>'+l.__("drag_or_click_here_to_upload_photo_attachment")+
" </div>"},validation:{allowedExtensions:mooConfig.attachmentExt,sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/topic/topic_upload/attachments/"+a("#plugin_topic_id").val()},callbacks:{onError:n.errorHandler,onComplete:function(d,e,c){d=a("#attachments").val();c.attachment_id?(h.activeEditor.insertContent('<p><a href="'+mooConfig.url.base+"/attachments/download/"+c.attachment_id+'" class="attached-file">'+c.original_filename+"</a></p><br>"),""==d?a("#attachments").val(c.attachment_id):
a("#attachments").val(d+","+c.attachment_id)):c.thumb&&(a("#topic_photo_ids").val(a("#topic_photo_ids").val()+","+c.photo_id),h.activeEditor.insertContent('<p align="center"><a href="'+c.large+'" class="attached-image"><img src="'+c.thumb+'"></a></p><br>'))}}});a("#triggerUpload").click(function(){b.uploadStoredFiles()});new m.fineUploader({element:a("#topic_thumnail")[0],multiple:!1,text:{uploadButton:'<div class="upload-section"><span class="upload-section-icon material-icons moo-icon moo-icon-photo_camera">photo_camera</span>'+
l.__("drag_or_click_here_to_upload_photo")+"</div>"},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/topic/topic_upload/avatar"},callbacks:{onError:n.errorHandler,onComplete:function(d,e,c){a("#topic_thumnail_preview > img").attr("src",c.thumb);a("#topic_thumnail_preview > img").show();a("#thumbnail").val(c.file_path)}}});a(".attach_remove").unbind("click");a(".attach_remove").click(function(){var d=a(this),e=a(this).data();t.post({url:mooConfig.url.base+
"/attachments/ajax_remove/"+e.id},function(c){d.parent().fadeOut();c=a("#attachments").val().split(",");var g=c.indexOf(d.attr("data-id"));c.splice(g,1);a("#attachments").val(c.join(","))});return!1});k();a("#toggleUploader").unbind("click");a("#toggleUploader").on("click",function(){a("#images-uploader").slideToggle()})},initOnView:function(){u.registerImageOverlay();k()},initOnListing:function(){f.initMoreResults();k();a(".likeItem").unbind("click");a(".likeItem").click(function(){var b=a(this),
d=a(this).data(),e=d.type,c=d.id,g=d.status;b.hasClass("do_ajax")||(b.addClass("do_ajax"),a.post(mooConfig.url.base+"/likes/ajax_add/"+e+"/"+c+"/"+g,{noCache:1},function(q){try{var r=a.parseJSON(q);b.parents(".like-section:first").find(".likeCount:first").html(parseInt(r.like_count));b.parents(".like-section:first").find(".dislikeCount:first").html(parseInt(r.dislike_count));g?(b.toggleClass("active"),b.next().next().removeClass("active")):(b.toggleClass("active"),b.prev().prev().removeClass("active"))}catch(w){p.validateUser()}b.removeClass("do_ajax")}))})},
toggleUploader:function(){a("#images-uploader").slideToggle()},initOnGroupListing:function(){f.initMoreResults();k();a(".likeItem").unbind("click");a(".likeItem").click(function(){var b=a(this),d=a(this).data(),e=d.status;a.post(mooConfig.url.base+"/likes/ajax_add/"+d.type+"/"+d.id+"/"+e,{noCache:1},function(c){try{var g=a.parseJSON(c);b.parents(".like-section:first").find(".likeCount:first").html(parseInt(g.like_count));b.parents(".like-section:first").find(".dislikeCount:first").html(parseInt(g.dislike_count));
e?(b.toggleClass("active"),b.next().next().removeClass("active")):(b.toggleClass("active"),b.prev().prev().removeClass("active"))}catch(q){p.validateUser()}})})}}});