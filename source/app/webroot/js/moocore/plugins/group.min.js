!function(o,t){"function"==typeof define&&define.amd?define(["jquery","mooBehavior","mooFileUploader","mooAlert","mooAjax","mooMention","mooTopic","mooToggleEmoji","mooButton","mooOverlay","mooGlobal","mooPhrase","spinner","autogrow","tipsy","tinyMCE","typeahead","bloodhound","tagsinput"],t):"object"==typeof exports?module.exports=t(require("jquery")):o.mooGroup=t()}(this,function(c,o,n,l,s,a,t,r,u,d,p,_){var m=function(){c(".deleteGroup").unbind("click"),c(".deleteGroup").click(function(){var o=c(this).data(),o=mooConfig.url.base+"/groups/do_delete/"+o.id;l.confirm(_.__("are_you_sure_you_want_to_remove_this_group_br_all_group_contents_will_also_be_deleted"),o)})},e=function(o,t){c.fn.SimpleModal({btn_ok:_.__("btn_ok"),btn_cancel:_.__("btn_cancel"),callback:function(){c.post(mooConfig.url.base+"/topics/ajax_delete/"+o,function(o){f("topics",mooConfig.url.base+"/topics/browse/group/"+t),"0"!=c("#group_topics_count").html()&&c("#group_topics_count").html(parseInt(c("#group_topics_count").html())-1)})},title:_.__("please_confirm"),contents:_.__("are_you_sure_you_want_to_remove_this_topic"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal()},i=function(){c(".cancelTopic").unbind("click"),c(".cancelTopic").on("click",function(){var o=c(this).data();c("#profile-content").load(o.url,{noCache:1},function(o){c("#profile-content").html(o)})}),c(".cancelTopic1").unbind("click"),c(".cancelTopic1").on("click",function(){var o=c(this).data();f("topics",o.url)})},f=function(t,o,e){c("#"+t).children(".badge_counter").hide(),c("#"+t).spin("tiny");var i=c(".groupId").attr("data-id");s.post({url:o,data:{group_id:i}},function(o){c("#"+t).children(".badge_counter").fadeIn(),c("#"+t).spin(!1),e?c("#profile-content").html(o.data):c("#profile-content").html(o),c("textarea").autogrow(),c(".tip").tipsy({html:!0,gravity:"s"}),d.registerImageOverlay(),c(".tipsy").remove(),a.init("postComment"),r.init(c(o).find("textarea").attr("id"),'<span class="post-area-icon material-icons moo-icon moo-icon-mood">mood</span>')})},g=function(t,o){var e="save";"topics"==t&&c("#editor").val(tinyMCE.activeEditor.getContent()),o&&(e="save"),u.disableButton("ajaxCreateButton");var i=c("#createForm #id").val();s.post({url:mooConfig.url.base+"/"+t+"/"+e,data:c("#createForm").serialize()},function(o){u.enableButton("ajaxCreateButton");o=c.parseJSON(o);1==o.result?(f(t,mooConfig.url.base+"/"+t+"/ajax_view/"+o.id),void 0===i&&c("#group_"+t+"_count").html(parseInt(c("#group_"+t+"_count").html())+1)):(c(".error-message").show(),c(".error-message").html(o.message))})};return{initOnCreate:function(){new n.fineUploader({element:c("#select-0")[0],multiple:!1,text:{uploadButton:'<div class="upload-section"><span class="upload-section-icon material-icons moo-icon moo-icon-photo_camera">photo_camera</span> '+_.__("drag_or_click_here_to_upload_photo")+"</div>"},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/group/group_upload/avatar"},callbacks:{onError:p.errorHandler,onComplete:function(o,t,e){c("#item-avatar").attr("src",e.file_url),c("#item-avatar").show(),c("#photo").val(e.file_path)}}});c("#saveBtn").unbind("click"),c("#saveBtn").click(function(){c(this).addClass("disabled"),null!==tinyMCE.activeEditor&&c("#editor").val(tinyMCE.activeEditor.getContent()),null!==tinyMCE.activeEditor&&c("#editor").val(tinyMCE.activeEditor.getContent()),o.createItem("groups",!0)})},initOnView:function(){c(".leaveGroup").unbind("click"),c(".leaveGroup").on("click",function(){var o=c(this).data(),o=mooConfig.url.base+"/groups/do_leave/"+o.id;l.confirm(_.__("are_you_sure_you_want_to_leave_this_group"),o)}),c("#profile-content").unbind("click"),c("#profile-content").on("click","#fetchButton",function(){return c("#fetchButton").spin("small"),c("#videoForm .error-message").hide(),u.disableButton("fetchButton"),s.post({url:mooConfig.url.base+"/videos/aj_validate",data:c("#createForm").serialize()},function(t){u.enableButton("fetchButton"),t?(c("#fetchForm .error-message").html(c.parseJSON(t).error),c("#fetchForm .error-message").show(),c("#fetchButton").spin(!1)):s.post({url:mooConfig.url.base+"/videos/fetch",data:c("#createForm").serialize()},function(o){u.enableButton("fetchButton"),c("#fetchForm").slideUp(),c("#videoForm").html(t)})}),!1}),m();var o=c(".topicId").attr("data-id"),t=c(".videoId").attr("data-id"),e=c(".commentId").attr("data-id"),i=c(".replyId").attr("data-id"),n="",a=c(".tab").attr("data-id"),r=c(".isEdit").attr("data-id");"0"!==e&&(n="/comment_id:"+e,"0"!==i&&(n+="/reply_id:"+i)),"0"!==o&&(c("#browseGroupDetail li").removeClass("current"),c("#topics").parent().addClass("current"),f("topics","0"!==r?mooConfig.url.base+"/topics/group_create/"+o:mooConfig.url.base+"/topics/ajax_view/"+o+n)),"0"!==t&&(c("#browseGroupDetail li").removeClass("current"),c("#videos").parent().addClass("current"),f("videos",mooConfig.url.base+"/videos/ajax_view/"+t+n)),0<c("#"+a).length&&(c("#"+a).spin("tiny"),c("#"+a).children(".badge_counter").hide(),c("#browseGroupDetail .current").removeClass("current"),c("#"+a).parent().addClass("current"),c("#profile-content").load(c("#"+a).attr("data-url"),{noCache:1},function(o){c("#"+a).spin(!1),c("#"+a).children(".badge_counter").fadeIn(),c("textarea").autogrow(),c(".tip").tipsy({html:!0,gravity:"s"}),d.registerOverlay()}))},initOnListing:function(){o.initMoreResults(),m()},initTabVideo:function(){c(".cancelVideo").unbind("click"),c(".cancelVideo").click(function(){var o=c(this).data();f("videos",mooConfig.url.base+"/videos/ajax_view/"+o.id)}),c(".saveVideo").unbind("click"),c(".saveVideo").click(function(){c("#videoModal").modal("hide"),g("videos",!0)})},initTabPhoto1:function(){c(".groupUploadPhoto").unbind("click"),c(".groupUploadPhoto").click(function(){var o=c(this).data();f("photos",mooConfig.url.base+"/photos/ajax_upload/Group_Group/"+o.groupId+"?content=1")}),o.initMoreResults()},initTabPhoto2:function(){var i=[],o=c("#target_id").val(),t=c("type").val(),e=new n.fineUploader({element:c("#photos_upload")[0],autoUpload:!1,text:{uploadButton:'<div class="upload-section"><span class="upload-section-icon material-icons moo-icon moo-icon-photo_camera">photo_camera</span> '+_.__("drag_or_click_here_to_upload_photo")+"</div>"},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/photo/photo_upload/album/"+t+"/"+o},callbacks:{onError:p.errorHandler,onComplete:function(o,t,e){c.isEmptyObject(e)||(i.push(e.photo),c("#new_photos").val(i.join(",")),c("#nextStep").show())}}});c("#triggerUpload").unbind("click"),c("#triggerUpload").click(function(){e.uploadStoredFiles()}),c("#nextStep").unbind("click"),c("#nextStep").click(function(){c("#loadingSpin").spin("tiny"),c("#uploadPhotoForm").submit(),c(this).addClass("disabled")})},initTabTopic:function(){},initAjaxInvite:function(){var o=new Bloodhound({datumTokenizer:function(o){return Bloodhound.tokenizers.whitespace(o.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:mooConfig.url.base+"/users/friends.json",cache:!1,filter:function(o){return c.map(o.data,function(o){return o})}},identify:function(o){return o.id}});o.initialize(),c("#friends").tagsinput({freeInput:!1,itemValue:"id",itemText:"name",typeaheadjs:{name:"friends_userTagging",displayKey:"name",highlight:!0,limit:10,source:o.ttAdapter(),templates:{notFound:['<div class="empty-message">',_.__("no_results"),"</div>"].join(" "),suggestion:function(o){if(""!=c("#friends").val()&&-1!=c("#friends").val().split(",").indexOf(o.id))return'<div class="empty-message" style="display:none">'+_.__("no_results")+"</div>";return['<div class="suggestion-item">','<img alt src="'+o.avatar+'"/>','<span class="text">'+o.name+"</span>","</div>"].join("")}}}}),c("#sendButton").unbind("click"),c("#sendButton").click(function(){return c("#sendButton").spin("small"),u.disableButton("sendButton"),c(".error-message").hide(),s.post({url:mooConfig.url.base+"/groups/ajax_sendInvite",data:c("#sendInvite").serialize()},function(o){u.enableButton("sendButton"),c("#sendButton").spin(!1);o=c.parseJSON(o);1==o.result?(c("#sendButton").hide(),c("#simple-modal-body").html(o.msg)):(c(".error-message").show(),c(".error-message").html(o.message))}),!1}),c("#invite_type_group").change(function(){c("#invite_friend").hide(),c("#invite_email").hide(),("1"==c("#invite_type_group").val()?c("#invite_friend"):c("#invite_email")).show()})},initOnTopicList:function(){c(".deleteTopic").unbind("click"),c(".deleteTopic").on("click",function(){var o=c(this).data();e(o.id,o.group)}),c(".createGroupTopic").unbind("click"),c(".createGroupTopic").on("click",function(){f("topics",mooConfig.url.base+"/topics/group_create")}),c(".ajaxLoadTopicDetail").unbind("click"),c(".ajaxLoadTopicDetail").on("click",function(){var o=c(this).data();f("topics",o.url)}),c(".ajaxLoadTopicEdit").unbind("click"),c(".ajaxLoadTopicEdit").on("click",function(){var o=c(this).data();f("topics",o.url)}),o.initMoreResults()},initOnCreateGroupTopic:function(){i(),c("#toggleUploader").unbind("click"),c("#toggleUploader").on("click",function(){t.toggleUploader()}),c("#ajaxCreateButton").unbind("click"),c("#ajaxCreateButton").on("click",function(){g("topics",!0)}),c(".deleteTopic").unbind("click"),c(".deleteTopic").on("click",function(){var o=c(this).data();e(o.id,o.group)});var o="advlist autolink lists link image charmap print preview hr anchor pagebreak searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking save table  directionality emoticons template paste textcolor";mooConfig.isMobile&&(o="textcolor emoticons fullscreen"),tinyMCE.remove("textarea#editor"),tinyMCE.init({selector:"textarea#editor",language:mooConfig.tinyMCE_language,skin:mooConfig.tinyMCE_skin,content_css:mooConfig.tinyMCE_content_css,content_style:mooConfig.tinyMCE_content_style,setup:function(o){o.on("change",function(){o.save()})},plugins:[o],toolbar1:"styleselect | bold italic | bullist numlist outdent indent | forecolor backcolor emoticons | link unlink anchor image | preview fullscreen code",image_advtab:!0,image_dimensions:!1,width:"100%",height:"300px",menubar:!1,forced_root_block:"div",relative_urls:!1,remove_script_host:!0,document_base_url:mooConfig.url.base,browser_spellcheck:!0,contextmenu:!1,entity_encoding:"raw",directionality:mooConfig.site_directionality})},removeMember:function(o){return c.fn.SimpleModal({btn_ok:_.__("btn_ok"),btn_cancel:_.__("btn_cancel"),callback:function(){c.post(mooConfig.url.base+"/groups/ajax_remove_member",{id:o},function(){c("#member_"+o).fadeOut(),"0"!=c("#group_user_count").html()&&c("#group_user_count").html(parseInt(c("#group_user_count").html())-1)})},title:_.__("please_confirm"),contents:_.__("are_you_sure_you_want_to_remove_this_member"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal(),!1},changeAdmin:function(o,t){var e=_.__("are_you_sure_you_want_to_make_this_member_a_group_admin");return"remove"==t&&(e=_.__("are_you_sure_you_want_to_demote_this_group_admin")),c.fn.SimpleModal({btn_ok:_.__("btn_ok"),btn_cancel:_.__("btn_cancel"),callback:function(){c.post(mooConfig.url.base+"/groups/ajax_change_admin",{id:o,type:t},function(){window.location.reload()})},title:_.__("please_confirm"),contents:e,model:"confirm",hideFooter:!1,closeButton:!1}).showModal(),!1},loadPage:f,initOnAjaxGroupVideo:function(){c("#profile-content").unbind("click"),c("#profile-content").on("click","#share-new",function(){var o=c(this).data();s.post({url:o.url,data:{group_id:o.id}},function(o){c("#videoModal .modal-content").html(o)})})},initOnAjaxViewTopic:function(o){c(".ajaxLoadTopicEdit").unbind("click"),c(".ajaxLoadTopicEdit").on("click",function(){var o=c(this).data();f("topics",o.url)}),c(".deleteTopic").unbind("click"),c(".deleteTopic").on("click",function(){var o=c(this).data();e(o.id,o.group)}),window.history.pushState({},"",o)}}});