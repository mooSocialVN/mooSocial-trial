!function(e,t){"function"==typeof define&&define.amd?define(["jquery","mooFileUploader","mooAlert","mooBehavior","mooAjax","mooButton","mooPhrase","mooGlobal","picker_date","picker_time","spinner","typeahead","bloodhound","tagsinput"],t):"object"==typeof exports?module.exports=t(require("jquery")):e.mooEvent=t()}(this,function(o,e,i,t,n,a,r,_){var s=function(){var e=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:mooConfig.url.base+"/users/friends.json",cache:!1,filter:function(e){return o.map(e.data,function(e){return e})}},identify:function(e){return e.id}});e.initialize(),o("#friends").tagsinput({freeInput:!1,itemValue:"id",itemText:"name",typeaheadjs:{name:"friends_userTagging",displayKey:"name",highlight:!0,limit:10,source:e.ttAdapter(),templates:{notFound:['<div class="empty-message">',r.__("no_results"),"</div>"].join(" "),suggestion:function(e){if(""!=o("#friends").val()&&-1!=o("#friends").val().split(",").indexOf(e.id))return'<div class="empty-message" style="display:none">'+r.__("no_results")+"</div>";return['<div class="suggestion-item">','<img alt src="'+e.avatar+'"/>','<span class="text">'+e.name+"</span>","</div>"].join("")}}}}),o("#sendButton").unbind("click"),o("#sendButton").click(function(){return o("#sendButton").spin("small"),a.disableButton("sendButton"),o(".error-message").hide(),n.post({url:mooConfig.url.base+"/events/sendInvite",data:o("#sendInvite").serialize()},function(e){a.enableButton("sendButton"),o("#sendButton").spin(!1);e=o.parseJSON(e);1==e.result?(o("#sendButton").hide(),o("#simple-modal-body").html(e.msg)):(o(".error-message").show(),o(".error-message").html(e.message))}),!1}),o("#invite_type_event").change(function(){o("#invite_friend").hide(),o("#invite_email").hide(),("1"==o("#invite_type_event").val()?o("#invite_friend"):o("#invite_email")).show()})},l=function(){o(".deleteEvent").unbind("click"),o(".deleteEvent").click(function(){var e=o(this).data(),e=mooConfig.url.base+"/events/do_delete/"+e.id;i.confirm(r.__("are_you_sure_you_want_to_remove_this_event"),e)})},d=function(){o(".inviteMore").unbind("click"),o(".inviteMore").click(function(){var e=o(this).data();o("#langModal .modal-content").html(""),o("#langModal .modal-content").spin("small"),o("#langModal .modal-content").load(e.url,function(){o("#langModal .modal-content").spin(!1),o("#langModal").modal("show")})})};return{initOnCreate:function(){new e.fineUploader({element:o("#select-0")[0],multiple:!1,text:{uploadButton:'<div class="upload-section"><span class="upload-section-icon material-icons moo-icon moo-icon-photo_camera">photo_camera</span>'+r.__("drag_or_click_here_to_upload_photo")+"</div>"},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/event/event_upload/avatar"},callbacks:{onError:_.errorHandler,onComplete:function(e,t,n){o("#photo").val(n.filename),o("#item-avatar").attr("src",n.thumb),o("#item-avatar").show(),o("#photo").val(n.file_path)}}});o(".datepicker").pickadate({monthsFull:[r.__("january"),r.__("february"),r.__("march"),r.__("april"),r.__("may"),r.__("june"),r.__("july"),r.__("august"),r.__("september"),r.__("october"),r.__("november"),r.__("december")],monthsShort:[r.__("jan"),r.__("feb"),r.__("mar"),r.__("apr"),r.__("may"),r.__("jun"),r.__("jul"),r.__("aug"),r.__("sep"),r.__("oct"),r.__("nov"),r.__("dec")],weekdaysFull:[r.__("sunday"),r.__("monday"),r.__("tuesday"),r.__("wednesday"),r.__("thursday"),r.__("friday"),r.__("saturday")],weekdaysShort:[r.__("sun"),r.__("mon"),r.__("tue"),r.__("wed"),r.__("thu"),r.__("fri"),r.__("sat")],today:r.__("today"),clear:r.__("clear"),format:"yyyy-mm-dd",close:!1,onClose:function(){var e,t;""!=o("#to").val()&&o("#from").val()>o("#to").val()&&(i.alert(r.__("to_date_must_be_greater_than_from_date")),o("#to").val("")),""!=o("#to").val()&&o("#from").val()>=o("#to").val()&&(e=parseInt(o("#from_time_root .picker__list-item--selected").attr("data-pick")),t=parseInt(o("#to_time_root .picker__list-item--selected").attr("data-pick")),""!=o("#to_time").val()&&t<=e&&(i.alert(r.__("to_time_must_be_greater_than_from_time")),o("#to").val(""),o("#to_time").val("")))}}),o(".timepicker").pickatime({clear:r.__("clear"),format:"24"==mooConfig.time_format?"H:i":"h:i A",onClose:function(e){var t,n;""!=o("#to").val()&&o("#from").val()>=o("#to").val()&&(t=parseInt(o("#from_time_root .picker__list-item--selected").attr("data-pick")),n=parseInt(o("#to_time_root .picker__list-item--selected").attr("data-pick")),""!=o("#to_time").val()&&n<=t&&(i.alert(r.__("to_time_must_be_greater_than_from_time")),o("#to").val(""),o("#to_time").val("")))}}),o("#saveBtn").unbind("click"),o("#saveBtn").click(function(){o(this).addClass("disabled"),null!==tinyMCE.activeEditor&&o("#editor").val(tinyMCE.activeEditor.getContent()),t.createItem("events",!0)}),l()},initOnView:function(){l(),d(),t.registerEventThumb()},initOnListing:function(){t.initMoreResults(),l()},initOnInvitePopup:function(){s()}}});