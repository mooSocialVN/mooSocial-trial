!function(t,o){"function"==typeof define&&define.amd?define(["jquery","mooBehavior","mooAlert","mooAjax","mooPhrase","mooOverlay","mooPhotoTheater","mooLike","hideshare","spinner"],o):"object"==typeof exports?module.exports=o(require("jquery")):t.mooPhoto=o()}(this,function(t,o,a,e,i,n,s,r){var l,c,p,u,d,h,_,m,g=!1,f=!1,b=0,v=0,w=0,k=0,y=2,C="",P=function(){t(".showPhoto").unbind("click"),t(".showPhoto").on("click",function(){var o=t(this).data();N(o.id)}),T()},T=function(){t(window).unbind("popstate"),t(window).on("popstate",function(){try{var t=window.location.href.split("?")[0];t=(t=t.replace(window.location.origin,"")).replace(mooConfig.url.base+"/photos/view/",""),isNaN(parseInt(t))||N(t,!0)}catch(t){}})},D=function(){t("#tags").find(".photoDetailTags").length>0?t("#tags").show():t("#tags").hide()},O=function(){var o=!1;t("#photoModal").on("hidden.bs.modal",function(){o&&location.reload()}),t(".rotate_img").unbind("click"),t(".rotate_img").on("click",function(){t(".rotate_img").hide();var a=t(this).data();t("#photo_wrapper").spin("large");var e=a.id;t.post(mooConfig.url.base+"/photos/ajax_rotate",{id:e,mode:a.mode},function(a){var i;(o=!0,dataJson=JSON.parse(a),console.log(dataJson[1500]),t("#photo_wrapper").spin(!1),t(".rotate_img").show(),t("#photo_src").attr("src",dataJson[1500]),t("#photo_thumb_"+e+" > a > img").attr("src",dataJson["75_square"]),t("#layer_square_modal_"+e).length)&&(i=(i=t("#layer_square_modal_"+e).css("background-image")).replace(/^url\(['"]?/,"").replace(/['"]?\)$/,""),i+="?"+(new Date).getTime(),t("#layer_square_modal_"+e).css("background-image","url("+i+")"));t("#layer_square_"+e).length&&(i=(i=t("#layer_square_"+e).css("background-image")).replace(/^url\(['"]?/,"").replace(/['"]?\)$/,""),i+="?"+(new Date).getTime(),t("#layer_square_"+e).css("background-image","url("+i+")"));t(".photoModal").each(function(){var o=t(this).find("img:first");o.attr("src",o.attr("src")+"?"+(new Date).getTime())})})})},x=function(){t("#photo_wrapper").spin("large"),t.post(mooConfig.url.base+"/photos/ajax_fetch",{type:type,album_type:album_type,album_type_id:album_type_id,target_id:target_id,page:y,taguserid:k},function(o){t("#photo_wrapper").spin(!1),""!=o&&(y++,t("#photo_thumbs ul").append(o),t("#photo_load_btn").parent().remove(),t("#photo_load_btn").unbind("click"),t("#photo_load_btn").on("click",function(){x()}),t(".showPhoto").unbind("click"),t(".showPhoto").on("click",function(){var o=t(this).data();N(o.id)}))})},j=function(){if(!g){g=!0;var o=t("#preload").html();""!=o&&(t("#preload").html(""),t("#photo-content").html(o),n.registerOverlay(),t(".sharethis").hideshare({media:t("#photo_src").attr("src"),linkedin:!1,link:window.location.href}),f&&I()),t("#photo_wrapper").fadeIn()}},q=function(){t("#set_cover").spin("tiny"),t.post(mooConfig.url.base+"/users/set_photo_as_cover",{photo_id:b},function(o){var a=t.parseJSON(o);window.location=a.url})},I=function(){f=!0,t("#tag-wrapper img").css("cursor","crosshair"),t("#tagPhoto a").html(i.__("done_tagging")),t("#tag-wrapper img").unbind("click"),t("#tag-wrapper img").click(function(o){f&&(p=o.pageX-t("#tag-wrapper").offset().left,u=o.pageY-t("#tag-wrapper").offset().top,d=t("#tag-target").outerWidth(),h=t("#tag-target").outerHeight(),l=p-d/2,c=u-h/2,_=p+d/2,m=u-h/2,"block"==t("#tag-target").css("display")?(t("#tag-target").animate({left:l,top:c},500),t("#tag-input").animate({left:_,top:m},500)):(t("#tag-target").css({left:l,top:c}).fadeIn(),t("#tag-input").css({left:_,top:m}).fadeIn()),t("#tag-name").focus(),t("#friends_list").html(t("#friends").html()),t(".tagFriends").unbind("click"),t(".tagFriends").on("click",function(){var o=t(this).data();A(o.id,o.tagValue)}))}),t("#tag-cancel").unbind("click"),t("#tag-cancel").click(function(){return B(),!1}),t("#tag-name").keyup(function(t){13==t.keyCode&&A(0,"")}),t("#tag-submit").unbind("click"),t("#tag-submit").click(function(){return A(0,""),!1})},J=function(t){t=void 0!==t?t:"0",a.confirm(i.__("are_you_sure_you_want_to_delete_this_photo"),mooConfig.url.base+"/photos/ajax_remove/photo_id:"+b+"/next_photo:"+t)},A=function(o,e){if(""!=o||""!=t("#tag-name").val()){var i="left:"+l+"px; top:"+c+"px";t("#photo_wrapper").spin("large"),t.post(mooConfig.url.base+"/photos/ajax_tag",{photo_id:b,uid:o,value:t("#tag-name").val(),style:i},function(n){t("#photo_wrapper").spin(!1);var s=t.parseJSON(n);1==s.result?(e=o?'<a href="'+mooConfig.url.base+"/users/view/"+o+'">'+e+"</a>":t("#tag-name").val(),t("#tags").find(".photo-list-tags").append('<span class="photoDetailTags" id="hotspot-item-'+v+"-"+s.id+'" data-tag-id="'+s.id+'" id="hotspot-item-'+v+'">'+e+'<a class="photoDetailRemoveTags" data-id="'+s.id+'" href="javascript:void(0)"><i class="material-icons cross-icon-sm">clear</i></a></span>'),t("#tag-wrapper").append('<div id="hotspot-'+v+"-"+s.id+'" class="hotspot" style="'+i+'"><span>'+e+"</span></div>"),B(),v++,D(),t(".photoDetailTags").off("mouseout"),t(".photoDetailTags").off("mouseover"),t(".photoDetailTags").on("mouseout",function(){var o=t(this).data();V("0-"+o.tagId)}).on("mouseover",function(){var o=t(this).data();M("0-"+o.tagId)}),t(".photoDetailRemoveTags").unbind("click"),t(".photoDetailRemoveTags").on("click",function(){var o=t(this).data();L("0-"+o.id,o.id)})):a.alert(s.message)})}},S=function(){t("#set_avatar").spin("tiny"),t.post(mooConfig.url.base+"/users/set_photo_as_profile_picture",{photo_id:b},function(o){var a=t.parseJSON(o);window.location=a.url})},N=function(o,a){a=void 0!==a&&a,b=o,t("#photo_wrapper").spin("large");var e="";g=!1,e=w?o+"/uid:"+w:k?o+"?uid="+k:o,t("#preload").load(mooConfig.url.base+"/photos/ajax_view/"+e,{noCache:1},function(){t("#photo_thumbs .active").removeClass("active"),t("#photo_thumb_"+o).addClass("active");var a=t("#preload").html();""!=a&&(t("#preload").html(""),t("#photo-content").html(a),n.registerOverlay(),t(".sharethis").hideshare({media:t("#photo_src").attr("src"),linkedin:!1,link:window.location.href}),f&&I()),t("#photo_wrapper").fadeIn()}),a||(window.history.pushState({photo_id:b},"",mooConfig.url.base+"/photos/view/"+e),window.history.replaceState({photo_id:b},"",mooConfig.url.base+"/photos/view/"+e))},R=function(){f=!1,t("#tag-wrapper img").css("cursor","default"),t("#tagPhoto a").html(i.__("tag_photo")),t("#tag-name").unbind(),t("#tag-submit").unbind(),B()},B=function(){t("#tag-target").fadeOut(),t("#tag-input").fadeOut(),t("#tag-name").val("")},L=function(o,a){t("#hotspot-item-"+o).remove(),t("#hotspot-"+o).remove(),D(),t.post(mooConfig.url.base+"/photos/ajax_remove_tag",{tag_id:a})},M=function(o){t("#hotspot-"+o).addClass("hotspothover")},V=function(o){t("#hotspot-"+o).removeClass("hotspothover")},F=function(){t(".deleteAlbum").unbind("click"),t(".deleteAlbum").click(function(){var o=t(this).data(),e=mooConfig.url.base+"/albums/do_delete/"+o.id;a.confirm(i.__("are_you_sure_you_want_to_delete_this_album_all_photos_will_also_be_deleted"),e)})};return{init:function(){s.init()},initOnCreateAlbum:function(){t("#saveBtn").unbind("click"),t("#saveBtn").click(function(){t(this).addClass("disabled"),o.createItem("albums",!0)})},initOnListing:function(){o.initMoreResults(),F()},initOnEditAlbum:function(){t("#select_photos").change(function(){"move"==t(this).val()?t("#album_id_select").removeClass("hidden"):t("#album_id_select").addClass("hidden")}),F()},initOnViewAlbum:function(){F()},initOnPhotoView:function(o){b=o.photo_id,photo_thumb=o.photo_thumb,w=o.tag_uid,k=o.taguserid,type=o.type,target_id=o.target_id,album_type=o.album_type,album_type_id=o.album_type_id,""==C&&(C=o.ref),t("#photo_thumbs ul li").unbind("click"),t("#photo_thumbs ul li:not(.viewmore-photo)").click(function(){t("#photo_thumbs ul li").removeClass("active"),t(this).addClass("active")}),t("#photo_thumb_"+b).addClass("active"),t(".sharethis").hideshare({media:mooConfig.url.base+"uploads/photos/thumbnail/"+b+"/"+photo_thumb,linkedin:!1}),t("#photo_src").on("load",function(){j()}),t("#delete_photo").unbind("click"),t("#delete_photo").on("click",function(){var o=t(this).data();J(o.nextPhoto)}),t(".set_cover").unbind("click"),t(".set_cover").on("click",function(){q()}),t(".set_avatar").unbind("click"),t(".set_avatar").on("click",function(){S()}),t("#tagPhoto").unbind("click"),t("#tagPhoto").click(function(){f?R():I()}),t(".photoDetailTags").on("mouseout",function(){var o=t(this).data();V("0-"+o.tagId)}).on("mouseover",function(){var o=t(this).data();M("0-"+o.tagId)}),t(".photoDetailRemoveTags").unbind("click"),t(".photoDetailRemoveTags").on("click",function(){var o=t(this).data();L("0-"+o.id,o.id)}),r.initLikePhoto(),P(),D(),t("#photo_load_btn").unbind("click"),t("#photo_load_btn").on("click",function(){x()}),O(),t("#photo_close_icon").attr("href",C)},initShowPhoto:P}});