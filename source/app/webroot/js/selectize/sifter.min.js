(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery"],b)}else{if(typeof exports==="object"){module.exports=b()}else{a.Sifter=b()}}}(this,function(d){var j=function(k,l){this.items=k;this.settings=l||{diacritics:true}};j.prototype.tokenize=function(o){o=b(String(o||"").toLowerCase());if(!o||!o.length){return[]}var k,r,m,l;var p=[];var q=o.split(/ +/);for(k=0,r=q.length;k<r;k++){m=f(q[k]);if(this.settings.diacritics){for(l in i){if(i.hasOwnProperty(l)){m=m.replace(new RegExp(l,"g"),i[l])}}}p.push({string:q[k],regex:new RegExp(m,"i")})}return p};j.prototype.iterator=function(k,m){var l;if(c(k)){l=Array.prototype.forEach||function(q){for(var o=0,p=this.length;o<p;o++){q(this[o],o,this)}}}else{l=function(o){for(var n in this){if(this.hasOwnProperty(n)){o(this[n],n,this)}}}}l.apply(k,[m])};j.prototype.getScoreFunction=function(r,s){var q,m,o,p,l;q=this;r=q.prepareSearch(r,s);o=r.tokens;m=r.options.fields;p=o.length;l=r.options.nesting;var n=function(u,t){var v,w;if(!u){return 0}u=String(u||"");w=u.search(t.regex);if(w===-1){return 0}v=t.string.length/u.length;if(w===0){v+=0.5}return v};var k=(function(){var t=m.length;if(!t){return function(){return 0}}if(t===1){return function(u,v){return n(a(v,m[0],l),u)}}return function(v,x){for(var u=0,w=0;u<t;u++){w+=n(a(x,m[u],l),v)}return w/t}})();if(!p){return function(){return 0}}if(p===1){return function(t){return k(o[0],t)}}if(r.options.conjunction==="and"){return function(v){var w;for(var t=0,u=0;t<p;t++){w=k(o[t],v);if(w<=0){return 0}u+=w}return u/p}}else{return function(v){for(var t=0,u=0;t<p;t++){u+=k(o[t],v)}return u/p}}};j.prototype.getSortFunction=function(w,x){var r,k,v,t,s,m,u,p,l,o,q;v=this;w=v.prepareSearch(w,x);q=(!w.query&&x.sort_empty)||x.sort;l=function(y,n){if(y==="$score"){return n.score}return a(v.items[n.id],y,x.nesting)};s=[];if(q){for(r=0,k=q.length;r<k;r++){if(w.query||q[r].field!=="$score"){s.push(q[r])}}}if(w.query){o=true;for(r=0,k=s.length;r<k;r++){if(s[r].field==="$score"){o=false;break}}if(o){s.unshift({field:"$score",direction:"desc"})}}else{for(r=0,k=s.length;r<k;r++){if(s[r].field==="$score"){s.splice(r,1);break}}}p=[];for(r=0,k=s.length;r<k;r++){p.push(s[r].direction==="desc"?-1:1)}m=s.length;if(!m){return null}else{if(m===1){t=s[0].field;u=p[0];return function(y,n){return u*g(l(t,y),l(t,n))}}else{return function(A,y){var C,n,z,B,D;for(C=0;C<m;C++){D=s[C].field;n=p[C]*g(l(D,A),l(D,y));if(n){return n}}return 0}}}};j.prototype.prepareSearch=function(n,k){if(typeof n==="object"){return n}k=e({},k);var m=k.fields;var o=k.sort;var l=k.sort_empty;if(m&&!c(m)){k.fields=[m]}if(o&&!c(o)){k.sort=[o]}if(l&&!c(l)){k.sort_empty=[l]}return{options:k,query:String(n||"").toLowerCase(),tokens:this.tokenize(n),total:0,items:[]}};j.prototype.search=function(n,s){var q=this,p,l,r,m;var k;var o;r=this.prepareSearch(n,s);s=r.options;n=r.query;o=s.score||q.getScoreFunction(r);if(n.length){q.iterator(q.items,function(t,u){l=o(t);if(s.filter===false||l>0){r.items.push({score:l,id:u})}})}else{q.iterator(q.items,function(t,u){r.items.push({score:1,id:u})})}k=q.getSortFunction(r,s);if(k){r.items.sort(k)}r.total=r.items.length;if(typeof s.limit==="number"){r.items=r.items.slice(0,s.limit)}return r};var g=function(l,k){if(typeof l==="number"&&typeof k==="number"){return l>k?1:(l<k?-1:0)}l=h(String(l||""));k=h(String(k||""));if(l>k){return 1}if(k>l){return -1}return 0};var e=function(m,l){var q,r,o,p;for(q=1,r=arguments.length;q<r;q++){p=arguments[q];if(!p){continue}for(o in p){if(p.hasOwnProperty(o)){m[o]=p[o]}}}return m};var a=function(n,k,l){if(!n||!k){return}if(!l){return n[k]}var m=k.split(".");while(m.length&&(n=n[m.shift()])){}return n};var b=function(k){return(k+"").replace(/^\s+|\s+$|/g,"")};var f=function(k){return(k+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")};var c=Array.isArray||(typeof d!=="undefined"&&d.isArray)||function(k){return Object.prototype.toString.call(k)==="[object Array]"};var i={a:"[aá¸€á¸Ä‚ÄƒÃ‚Ã¢ÇÇŽÈºâ±¥È¦È§áº áº¡Ã„Ã¤Ã€Ã ÃÃ¡Ä€ÄÃƒÃ£Ã…Ã¥Ä…Ä„ÃƒÄ…Ä„]",b:"[bâ¢Î²Î’Bà¸¿ðŒá›’]",c:"[cÄ†Ä‡ÄˆÄ‰ÄŒÄÄŠÄ‹CÌ„cÌ„Ã‡Ã§á¸ˆá¸‰È»È¼Æ‡ÆˆÉ•á´„ï¼£ï½ƒ]",d:"[dÄŽÄá¸Šá¸‹á¸á¸‘á¸Œá¸á¸’á¸“á¸Žá¸ÄÄ‘DÌ¦dÌ¦Æ‰É–ÆŠÉ—Æ‹ÆŒáµ­á¶á¶‘È¡á´…ï¼¤ï½„Ã°]",e:"[eÃ‰Ã©ÃˆÃ¨ÃŠÃªá¸˜á¸™ÄšÄ›Ä”Ä•áº¼áº½á¸šá¸›áººáº»Ä–Ä—Ã‹Ã«Ä’Ä“È¨È©Ä˜Ä™á¶’É†É‡È„È…áº¾áº¿á»€á»á»„á»…á»‚á»ƒá¸œá¸á¸–á¸—á¸”á¸•È†È‡áº¸áº¹á»†á»‡â±¸á´‡ï¼¥ï½…É˜ÇÆÆÎµ]",f:"[fÆ‘Æ’á¸žá¸Ÿ]",g:"[gÉ¢â‚²Ç¤Ç¥ÄœÄÄžÄŸÄ¢Ä£Æ“É Ä Ä¡]",h:"[hÄ¤Ä¥Ä¦Ä§á¸¨á¸©áº–áº–á¸¤á¸¥á¸¢á¸£É¦Ê°Ç¶Æ•]",i:"[iÃÃ­ÃŒÃ¬Ä¬Ä­ÃŽÃ®ÇÇÃÃ¯á¸®á¸¯Ä¨Ä©Ä®Ä¯ÄªÄ«á»ˆá»‰ÈˆÈ‰ÈŠÈ‹á»Šá»‹á¸¬á¸­Æ—É¨É¨Ì†áµ»á¶–Ä°iIÄ±Éªï¼©ï½‰]",j:"[jÈ·Ä´ÄµÉˆÉ‰ÊÉŸÊ²]",k:"[kÆ˜Æ™ê€êá¸°á¸±Ç¨Ç©á¸²á¸³á¸´á¸µÎºÏ°â‚­]",l:"[lÅÅ‚Ä½Ä¾Ä»Ä¼Ä¹Äºá¸¶á¸·á¸¸á¸¹á¸¼á¸½á¸ºá¸»Ä¿Å€È½Æšâ± â±¡â±¢É«É¬á¶…É­È´ÊŸï¼¬ï½Œ]",n:"[nÅƒÅ„Ç¸Ç¹Å‡ÅˆÃ‘Ã±á¹„á¹…Å…Å†á¹†á¹‡á¹Šá¹‹á¹ˆá¹‰NÌˆnÌˆÆÉ²È Æžáµ°á¶‡É³ÈµÉ´ï¼®ï½ŽÅŠÅ‹]",o:"[oÃ˜Ã¸Ã–Ã¶Ã“Ã³Ã’Ã²Ã”Ã´Ç‘Ç’ÅÅ‘ÅŽÅÈ®È¯á»Œá»ÆŸÉµÆ Æ¡á»Žá»ÅŒÅÃ•ÃµÇªÇ«ÈŒÈÕ•Ö…]",p:"[pá¹”á¹•á¹–á¹—â±£áµ½Æ¤Æ¥áµ±]",q:"[qê–ê—Ê ÉŠÉ‹ê˜ê™qÌƒ]",r:"[rÅ”Å•ÉŒÉÅ˜Å™Å–Å—á¹˜á¹™ÈÈ‘È’È“á¹šá¹›â±¤É½]",s:"[sÅšÅ›á¹ á¹¡á¹¢á¹£êž¨êž©ÅœÅÅ Å¡ÅžÅŸÈ˜È™SÌˆsÌˆ]",t:"[tÅ¤Å¥á¹ªá¹«Å¢Å£á¹¬á¹­Æ®ÊˆÈšÈ›á¹°á¹±á¹®á¹¯Æ¬Æ­]",u:"[uÅ¬Å­É„Ê‰á»¤á»¥ÃœÃ¼ÃšÃºÃ™Ã¹Ã›Ã»Ç“Ç”Å°Å±Å¬Å­Æ¯Æ°á»¦á»§ÅªÅ«Å¨Å©Å²Å³È”È•âˆª]",v:"[vá¹¼á¹½á¹¾á¹¿Æ²Ê‹êžêŸâ±±Ê‹]",w:"[wáº‚áºƒáº€áºÅ´Åµáº„áº…áº†áº‡áºˆáº‰]",x:"[xáºŒáºáºŠáº‹Ï‡]",y:"[yÃÃ½á»²á»³Å¶Å·Å¸Ã¿á»¸á»¹áºŽáºá»´á»µÉŽÉÆ³Æ´]",z:"[zÅ¹Åºáºáº‘Å½Å¾Å»Å¼áº’áº“áº”áº•ÆµÆ¶]"};var h=(function(){var p,s,l,o;var m="";var r={};for(l in i){if(i.hasOwnProperty(l)){o=i[l].substring(2,i[l].length-1);m+=o;for(p=0,s=o.length;p<s;p++){r[o.charAt(p)]=l}}}var q=new RegExp("["+m+"]","g");return function(k){return k.replace(q,function(n){return r[n]}).toLowerCase()}})();return j}));