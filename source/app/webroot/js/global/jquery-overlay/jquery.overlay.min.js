/*
 jQuery.textoverlay.js

 Repository: https://github.com/yuku-t/jquery-textoverlay
 License:    MIT
 Author:     Yuku Takahashi, Dang Thanh Nam
*/
(function(t){if("function"===typeof define&&define.amd)define(["jquery"],t);else if("object"===typeof module&&module.exports){var u=require("jquery");module.exports=t(u)}else t(jQuery)})(function(t){var u=function(){return"undefined"!==typeof $("<div></div>").css(["color"]).color?function(b,d){return b.css(d)}:function(b,d){var g={};$.each(d,function(q,h){g[h]=b.css(h)});return g}}(),m={},A={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},B=/[&<>"'\/]/g,n=function(b){if("undefined"!==
typeof b)return b.replace(B,function(d){return A[d]})},z=function(){function b(a){var p=a.css("position");"static"===p&&(p="relative");p=$(d.wrapper).css($.extend({},g.wrapper,u(a,q),{position:p}));this.textareaTop=parseInt(a.css("border-top-width"));this.$el=$(d.overlay).css($.extend({},g.overlay,u(a,h),{top:this.textareaTop,right:parseInt(a.css("border-right-width")),bottom:parseInt(a.css("border-bottom-width")),left:parseInt(a.css("border-left-width"))}));this.$textarea=a.css(g.textarea);this.$textarea.wrap(p).before(this.$el);
this.$textarea.origVal=a.val;this.$textarea.val=$.proxy(this.val,this);this.$textarea.on({"input.overlay":$.proxy(this.onInput,this),"change.overlay":$.proxy(this.onInput,this),"scroll.overlay":$.proxy(this.resizeOverlay,this),"resize.overlay":$.proxy(this.resizeOverlay,this)});this.strategies=[]}var d={wrapper:'<div class="textoverlay-wrapper"></div>',overlay:'<div class="textoverlay"></div>'};var g={wrapper:{margin:0,padding:0,overflow:"hidden"},overlay:{position:"absolute",color:"transparent",
"white-space":"pre-wrap","word-wrap":"break-word",overflow:"hidden"},textarea:{background:"transparent",position:"relative",outline:0}};var q="";var h="margin-top margin-right margin-bottom margin-left padding-top padding-right padding-bottom padding-left font-family font-weight font-size background-color".split(" ");$.extend(b.prototype,{val:function(a){return null==a?this.$textarea.origVal():this.setVal(a)},setVal:function(a){this.$textarea.origVal(a);this.renderTextOnOverlay();return this.$textarea},
onInput:function(a){this.renderTextOnOverlay()},renderTextOnOverlay:function(){var a;var p=$("<div></div>").text(this.$textarea.val());var v=0;for(a=this.strategies.length;v<a;v++){var r=this.strategies[v];var e=r.match;$.isArray(e)&&(e=$.map(e,function(c){return c.replace(/(\(|\)|\|)/g,"$1")}),e=new RegExp("("+e.join("|")+")","g"));var x="background-color:"+r.css["background-color"];p.contents().each(function(){var c;if(this.nodeType==Node.TEXT_NODE){var k=this.textContent;var l="";if($.isArray(r.match)||
null===r.match||"object"!==typeof r.match){for(c=e.lastIndex=0;;c=e.lastIndex){var f=e.exec(k);if(!f){c&&(l+=n(k.substr(c)));break}f=f[0];l+=n(k.substr(c,e.lastIndex-c-f.length));l+='<span style="'+x+'">'+n(f)+"</span>"}c&&$(this).replaceWith(l)}else{f=[];var y=[];for(c in e)e.hasOwnProperty(c)&&(f.push(k.substr(e[c].start,e[c].length)),y.push(e[c].end));if(0<f.length){for(var w in f)if(-1!=f[w].indexOf(")")||-1!=f[w].indexOf("(")||-1!=f[w].indexOf("|"))return;e=new RegExp("("+f.join("|")+")","g");
for(c=e.lastIndex=0;;c=e.lastIndex){f=e.exec(k);if(!f){c&&(l+=n(k.substr(c)));break}0!=e.lastIndex&&-1==y.indexOf(e.lastIndex)?l+=n(k.substr(c,e.lastIndex-c)):(f=f[0],l+=n(k.substr(c,e.lastIndex-c-f.length)),l+='<span style="'+x+'">'+n(f)+"</span>")}c&&$(this).replaceWith(l)}else $(this).replaceWith(n(k))}}})}this.$el.html(p.contents());return this},resizeOverlay:function(){this.$el.css({top:this.textareaTop-this.$textarea.scrollTop()})},register:function(a){a=$.isArray(a)?a:[a];this.strategies=this.strategies.concat(a);
return this.renderTextOnOverlay()},destroy:function(){this.$textarea.off(".overlay");this.$textarea.parent().after(this.$textarea).remove();this.$textarea.removeData("overlay");this.$textarea=null},getStrategy:function(){return this.strategies},reRegister:function(a){a=$.isArray(a)?a:[a];this.strategies=this.strategies.concat(a)}});return b}();$.fn.overlay=function(b){return void 0!==m[$(this).attr("id")]?this.each(function(){var d=m[$(this).attr("id")];$(this).revokeOverlay(b,d,!0);$(this).reRenderTextOnOverlay(d)}):
"destroy"===b?this.each(function(){var d=$(this).data("overlay");d&&d.destroy()}):this.each(function(){var d=$(this);var g=d.data("overlay");g||(g=new z(d),m[d.attr("id")]=g,d.data("overlay",g));g.register(b)})};$.fn.getInstanceOverlay=function(b){if(void 0!==m[b.attr("id")])return m[b.attr("id")];b=m[b.attr("id")]=new z($(this));b.register(b.getStrategy());return b};$.fn.revokeOverlay=function(b,d,g){for(var q=d.getStrategy(),h=0,a=q.length;h<a;h++)"undefined"===typeof g?$.extend(q[h],b[h]):$.extend(b[h],
q[h]);d.strategies="undefined"===typeof g?q:b};$.fn.reRenderTextOnOverlay=function(b){b.renderTextOnOverlay()};$.fn.destroyOverlayInstance=function(b){void 0!==m[b.attr("id")]&&delete m[b.attr("id")]}});