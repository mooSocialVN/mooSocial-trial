!function(o){function a(t,e){this.element=t,this.settings=o.extend({},o.fn.rate.settings,e),this.set_faces={},this.build()}o.fn.textWidth=function(){var t=o("<span>"+o(this).html()+"</span>");t.css("font-size",o(this).css("font-size")).hide(),t.prependTo("body");var e=t.width();if(t.remove(),0!=e)return e;var s=0;return o(this).eq(0).children().each(function(){s+=o(this).textWidth()}),s},o.fn.textHeight=function(){var t=o("<span>"+o(this).html()+"</span>");t.css("font-size",o(this).css("font-size")).hide(),t.prependTo("body");var e=t.height();return t.remove(),e},Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},String.prototype.getCodePointLength=function(){return this.length-this.split(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g).length+1},String.fromCodePoint=function(){for(var t=Array.prototype.slice.call(arguments),e=t.length;0<e--;){var s=t[e]-65536;0<=s&&t.splice(e,1,55296+(s>>10),56320+(1023&s))}return String.fromCharCode.apply(null,t)},o.fn.rate=function(e){if(void 0===e||"object"==typeof e)return this.each(function(){o.data(this,"rate")||o.data(this,"rate",new a(this,e))});if("string"==typeof e){var s,i=arguments;return this.each(function(){var t=o.data(this,"rate");t instanceof a&&"function"==typeof t[e]&&(s=t[e].apply(t,Array.prototype.slice.call(i,1))),"destroy"===e&&(o(t.element).off(),o.data(this,"rate",null))}),void 0!==s?s:this}},a.prototype.build=function(){this.layers={},this.value=0,this.raise_select_layer=!1,this.icon_class="",this.settings.initial_value&&(this.value=this.settings.initial_value),o(this.element).attr("data-rate-value")&&(this.value=o(this.element).attr("data-rate-value")),o(this.element).attr("data-icon-class")&&(this.icon_class=o(this.element).attr("data-icon-class"));var t=this.value/this.settings.max_value*100;"string"==typeof this.settings.symbols[this.settings.selected_symbol_type]&&(s=this.settings.symbols[this.settings.selected_symbol_type],this.settings.symbols[this.settings.selected_symbol_type]={},this.settings.symbols[this.settings.selected_symbol_type].base=s,this.settings.symbols[this.settings.selected_symbol_type].selected=s,this.settings.symbols[this.settings.selected_symbol_type].hover=s);var e=this.addLayer("base-layer",100,this.settings.symbols[this.settings.selected_symbol_type].base,!0),s=this.addLayer("select-layer",t,this.settings.symbols[this.settings.selected_symbol_type].selected,!0),t=this.addLayer("hover-layer",0,this.settings.symbols[this.settings.selected_symbol_type].hover,!1);this.layers.base_layer=e,this.layers.select_layer=s,this.layers.hover_layer=t,o(this.element).on("mousemove",o.proxy(this.hover,this)),o(this.element).on("click",o.proxy(this.select,this)),o(this.element).on("mouseleave",o.proxy(this.mouseout,this)),o(this.element).css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"}),this.settings.hasOwnProperty("update_input_field_name")&&this.settings.update_input_field_name.val(this.value)},a.prototype.addLayer=function(t,e,s,i){for(var a="<div>",n=0;n<this.settings.max_value;n++)Array.isArray(s)?(this.settings.convert_to_utf8&&(s[n]=String.fromCodePoint(s[n])),a+="<span>"+s[n]+"</span>"):(this.settings.convert_to_utf8&&(s=String.fromCodePoint(s)),a+="<span>"+s+"</span>");t=o(a+="</div>").addClass("rate-"+t).appendTo(this.element);return(0<o(t).children().children().length?o(t).children():o(t)).children().addClass(this.icon_class),o(t).css({width:e+"%",height:o(t).children().eq(0).textHeight(),overflow:"hidden",position:"absolute",top:0,display:i?"block":"none","white-space":"nowrap"}),o(this.element).css({width:o(t).textWidth()+"px",height:o(t).height(),position:"relative",cursor:this.settings.cursor}),t},a.prototype.updateServer=function(){null!=this.settings.url&&o.ajax({url:this.settings.url,type:this.settings.ajax_method,data:o.extend({},{value:this.getValue()},this.settings.additional_data),success:o.proxy(function(t){o(this.element).trigger("updateSuccess",[t])},this),error:o.proxy(function(t,e,s){o(this.element).trigger("updateError",[t,e,s])},this)})},a.prototype.getValue=function(){return this.value},a.prototype.hover=function(t){var e=parseInt(o(this.element).css("padding-left").replace("px","")),t=t.pageX-o(this.element).offset().left-e,e=this.toValue(t,!0);e!=this.value&&(this.raise_select_layer=!1),this.raise_select_layer||this.settings.readonly||(t=this.toWidth(e),this.layers.select_layer.css({display:"none"}),this.settings.only_select_one_symbol?(e=Math.floor(e),this.layers.hover_layer.css({width:"100%",display:"block"}),this.layers.hover_layer.children("span").css({visibility:"hidden"}),this.layers.hover_layer.children("span").eq(0!=e?e-1:0).css({visibility:"visible"})):this.layers.hover_layer.css({width:t+"%",display:"block"}))},a.prototype.select=function(t){var e;this.settings.readonly||(this.getValue(),e=parseInt(o(this.element).css("padding-left").replace("px","")),e=t.pageX-o(this.element).offset().left-e,e=this.toWidth(this.toValue(e,!0)),this.setValue(this.toValue(e)),this.raise_select_layer=!0)},a.prototype.mouseout=function(){this.layers.hover_layer.css({display:"none"}),this.layers.select_layer.css({display:"block"})},a.prototype.toWidth=function(t){return t/this.settings.max_value*100},a.prototype.toValue=function(t,e){e=e?t/this.layers.base_layer.textWidth()*this.settings.max_value:t/100*this.settings.max_value,t=e/this.settings.step_size;return t-Math.floor(t)<5e-5&&(e=Math.round(e/this.settings.step_size)*this.settings.step_size),e=(e=Math.ceil(e/this.settings.step_size)*this.settings.step_size)>this.settings.max_value?this.settings.max_value:e},a.prototype.getElement=function(t,e){return o(this.element).find(".rate-"+t+" span").eq(e-1)},a.prototype.getLayers=function(){return this.layers},a.prototype.setFace=function(t,e){this.set_faces[t]=e},a.prototype.setAdditionalData=function(t){this.settings.additional_data=t},a.prototype.getAdditionalData=function(){return this.settings.additional_data},a.prototype.removeFace=function(t){delete this.set_faces[t]},a.prototype.setValue=function(t){var e,s,i,a,n,l,r;this.settings.readonly||(t<0?t=0:t>this.settings.max_value&&(t=this.settings.max_value),e=this.getValue(),this.value=t,o(this.element).trigger("change",{from:e,to:this.value}),o(this.element).find(".rate-face").remove(),o(this.element).find("span").css({visibility:"visible"}),s=Math.ceil(this.value),this.set_faces.hasOwnProperty(s)&&(i="<div>"+this.set_faces[s]+"</div>",a=this.getElement("base-layer",s),n=this.getElement("select-layer",s),l=this.getElement("hover-layer",s),t=a.textWidth()*(s-1)+(a.textWidth()-o(i).textWidth())/2,o(i).appendTo(this.element).css({display:"inline-block",position:"absolute",left:t}).addClass("rate-face"),a.css({visibility:"hidden"}),n.css({visibility:"hidden"}),l.css({visibility:"hidden"})),this.settings.only_select_one_symbol?(r=this.toWidth(this.settings.max_value),this.layers.select_layer.css({display:"block",width:r+"%",height:this.layers.base_layer.css("height")}),this.layers.hover_layer.css({display:"none",height:this.layers.base_layer.css("height")}),this.layers.select_layer.children("span").css({visibility:"hidden"}),this.layers.select_layer.children("span").eq(0!=s?s-1:0).css({visibility:"visible"})):(r=this.toWidth(this.value),this.layers.select_layer.css({display:"block",width:r+"%",height:this.layers.base_layer.css("height")}),this.layers.hover_layer.css({display:"none",height:this.layers.base_layer.css("height")})),o(this.element).attr("data-rate-value",this.value),this.settings.change_once&&(this.settings.readonly=!0),this.updateServer(),o(this.element).trigger("afterChange",{from:e,to:this.value}),this.settings.hasOwnProperty("update_input_field_name")&&this.settings.update_input_field_name.val(this.value))},a.prototype.increment=function(){this.setValue(this.getValue()+this.settings.step_size)},a.prototype.decrement=function(){this.setValue(this.getValue()-this.settings.step_size)},o.fn.rate.settings={max_value:5,step_size:.5,initial_value:0,symbols:{utf8_star:{base:"☆",hover:"★",selected:"★"},utf8_hexagon:{base:"⬡",hover:"⬢",selected:"⬢"},hearts:"&hearts;",fontawesome_beer:'<i class="fa fa-beer"></i>',fontawesome_star:{base:'<i class="fa fa-star-o"></i>',hover:'<i class="fa fa-star"></i>',selected:'<i class="fa fa-star"></i>'},utf8_emoticons:{base:[128549,128531,128530,128516],hover:[128549,128531,128530,128516],selected:[128549,128531,128530,128516]},moo_star:{base:'<div class="material-icons core-rating-icon core-rating-base">star_border</div>',hover:'<div class="material-icons core-rating-icon core-rating-hover">star</div>',selected:'<div class="material-icons core-rating-icon core-rating-selected">star</div>'}},selected_symbol_type:"moo_star",convert_to_utf8:!1,cursor:"default",readonly:!1,change_once:!1,only_select_one_symbol:!1,ajax_method:"POST",additional_data:{}}}(jQuery,window);